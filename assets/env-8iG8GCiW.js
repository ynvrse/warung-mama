import{j as an,r as O}from"./theme-provider-C3d4einS.js";import{c as E,a as hr,d as pr}from"./App-DM7DqXAy.js";import{a as yr}from"./index-rbqaS3as.js";/**
 * @license lucide-react v0.532.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const br=[["path",{d:"M12 20.94c1.5 0 2.75 1.06 4 1.06 3 0 6-8 6-12.22A4.91 4.91 0 0 0 17 5c-2.22 0-4 1.44-5 2-1-.56-2.78-2-5-2a4.9 4.9 0 0 0-5 4.78C2 14 5 22 8 22c1.25 0 2.5-1.06 4-1.06Z",key:"3s7exb"}],["path",{d:"M10 2c1 .5 2 2 2 5",key:"fcco2y"}]],cn=E("apple",br);/**
 * @license lucide-react v0.532.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vr=[["path",{d:"M10 16c.5.3 1.2.5 2 .5s1.5-.2 2-.5",key:"1u7htd"}],["path",{d:"M15 12h.01",key:"1k8ypt"}],["path",{d:"M19.38 6.813A9 9 0 0 1 20.8 10.2a2 2 0 0 1 0 3.6 9 9 0 0 1-17.6 0 2 2 0 0 1 0-3.6A9 9 0 0 1 12 3c2 0 3.5 1.1 3.5 2.5s-.9 2.5-2 2.5c-.8 0-1.5-.4-1.5-1",key:"11xh7x"}],["path",{d:"M9 12h.01",key:"157uk2"}]],un=E("baby",vr);/**
 * @license lucide-react v0.532.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _r=[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}]],dn=E("book",_r);/**
 * @license lucide-react v0.532.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gr=[["path",{d:"M7.2 14.8a2 2 0 0 1 2 2",key:"1tw9gg"}],["circle",{cx:"18.5",cy:"8.5",r:"3.5",key:"1wadoa"}],["circle",{cx:"7.5",cy:"16.5",r:"5.5",key:"6mdt3g"}],["circle",{cx:"7.5",cy:"4.5",r:"2.5",key:"637s54"}]],ln=E("bubbles",gr);/**
 * @license lucide-react v0.532.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wr=[["path",{d:"M2.27 21.7s9.87-3.5 12.73-6.36a4.5 4.5 0 0 0-6.36-6.37C5.77 11.84 2.27 21.7 2.27 21.7zM8.64 14l-2.05-2.04M15.34 15l-2.46-2.46",key:"rfqxbe"}],["path",{d:"M22 9s-1.33-2-3.5-2C16.86 7 15 9 15 9s1.33 2 3.5 2S22 9 22 9z",key:"6b25w4"}],["path",{d:"M15 2s-2 1.33-2 3.5S15 9 15 9s2-1.84 2-3.5C17 3.33 15 2 15 2z",key:"fn65lo"}]],fn=E("carrot",wr);/**
 * @license lucide-react v0.532.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mr=[["path",{d:"M17 12H3a1 1 0 0 0-1 1v2a1 1 0 0 0 1 1h14",key:"1mb5g1"}],["path",{d:"M18 8c0-2.5-2-2.5-2-5",key:"1il607"}],["path",{d:"M21 16a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"1yl5r7"}],["path",{d:"M22 8c0-2.5-2-2.5-2-5",key:"1gah44"}],["path",{d:"M7 12v4",key:"jqww69"}]],hn=E("cigarette",mr);/**
 * @license lucide-react v0.532.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Or=[["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M14 2v2",key:"6buw04"}],["path",{d:"M16 8a1 1 0 0 1 1 1v8a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4V9a1 1 0 0 1 1-1h14a4 4 0 1 1 0 8h-1",key:"pwadti"}],["path",{d:"M6 2v2",key:"colzsn"}]],pn=E("coffee",Or);/**
 * @license lucide-react v0.532.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kr=[["path",{d:"m6 8 1.75 12.28a2 2 0 0 0 2 1.72h4.54a2 2 0 0 0 2-1.72L18 8",key:"8166m8"}],["path",{d:"M5 8h14",key:"pcz4l3"}],["path",{d:"M7 15a6.47 6.47 0 0 1 5 0 6.47 6.47 0 0 0 5 0",key:"yjz344"}],["path",{d:"m12 8 1-6h2",key:"3ybfa4"}]],yn=E("cup-soda",kr);/**
 * @license lucide-react v0.532.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sr=[["path",{d:"M12 22a7 7 0 0 0 7-7c0-2-1-3.9-3-5.5s-3.5-4-4-6.5c-.5 2.5-2 4.9-4 6.5C6 11.1 5 13 5 15a7 7 0 0 0 7 7z",key:"c7niix"}]],bn=E("droplet",Sr);/**
 * @license lucide-react v0.532.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jr=[["path",{d:"M6.5 12c.94-3.46 4.94-6 8.5-6 3.56 0 6.06 2.54 7 6-.94 3.47-3.44 6-7 6s-7.56-2.53-8.5-6Z",key:"15baut"}],["path",{d:"M18 12v.5",key:"18hhni"}],["path",{d:"M16 17.93a9.77 9.77 0 0 1 0-11.86",key:"16dt7o"}],["path",{d:"M7 10.67C7 8 5.58 5.97 2.73 5.5c-1 1.5-1 5 .23 6.5-1.24 1.5-1.24 5-.23 6.5C5.58 18.03 7 16 7 13.33",key:"l9di03"}],["path",{d:"M10.46 7.26C10.2 5.88 9.17 4.24 8 3h5.8a2 2 0 0 1 1.98 1.67l.23 1.4",key:"1kjonw"}],["path",{d:"m16.01 17.93-.23 1.4A2 2 0 0 1 13.8 21H9.5a5.96 5.96 0 0 0 1.49-3.98",key:"1zlm23"}]],vn=E("fish",jr);/**
 * @license lucide-react v0.532.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mr=[["path",{d:"M8 2h8",key:"1ssgc1"}],["path",{d:"M9 2v2.789a4 4 0 0 1-.672 2.219l-.656.984A4 4 0 0 0 7 10.212V20a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2v-9.789a4 4 0 0 0-.672-2.219l-.656-.984A4 4 0 0 1 15 4.788V2",key:"qtp12x"}],["path",{d:"M7 15a6.472 6.472 0 0 1 5 0 6.47 6.47 0 0 0 5 0",key:"ygeh44"}]],_n=E("milk",Mr);/**
 * @license lucide-react v0.532.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $r=[["path",{d:"M12 3v6",key:"1holv5"}],["path",{d:"M16.76 3a2 2 0 0 1 1.8 1.1l2.23 4.479a2 2 0 0 1 .21.891V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V9.472a2 2 0 0 1 .211-.894L5.45 4.1A2 2 0 0 1 7.24 3z",key:"187q7i"}],["path",{d:"M3.054 9.013h17.893",key:"grwhos"}]],Qe=E("package-2",$r);/**
 * @license lucide-react v0.532.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ar=[["path",{d:"M18 8a2 2 0 0 0 0-4 2 2 0 0 0-4 0 2 2 0 0 0-4 0 2 2 0 0 0-4 0 2 2 0 0 0 0 4",key:"10td1f"}],["path",{d:"M10 22 9 8",key:"yjptiv"}],["path",{d:"m14 22 1-14",key:"8jwc8b"}],["path",{d:"M20 8c.5 0 .9.4.8 1l-2.6 12c-.1.5-.7 1-1.2 1H7c-.6 0-1.1-.4-1.2-1L3.2 9c-.1-.6.3-1 .8-1Z",key:"1qo33t"}]],gn=E("popcorn",Ar);/**
 * @license lucide-react v0.532.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ir=[["path",{d:"M20.38 3.46 16 2a4 4 0 0 1-8 0L3.62 3.46a2 2 0 0 0-1.34 2.23l.58 3.47a1 1 0 0 0 .99.84H6v10c0 1.1.9 2 2 2h8a2 2 0 0 0 2-2V10h2.15a1 1 0 0 0 .99-.84l.58-3.47a2 2 0 0 0-1.34-2.23z",key:"1wgbhj"}]],wn=E("shirt",Ir);/**
 * @license lucide-react v0.532.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tr=[["path",{d:"M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2",key:"cjf0a3"}],["path",{d:"M7 2v20",key:"1473qp"}],["path",{d:"M21 15V2a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7",key:"j28e5"}]],mn=E("utensils",Tr);/**
 * @license lucide-react v0.532.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Er=[["path",{d:"M2 22 16 8",key:"60hf96"}],["path",{d:"M3.47 12.53 5 11l1.53 1.53a3.5 3.5 0 0 1 0 4.94L5 19l-1.53-1.53a3.5 3.5 0 0 1 0-4.94Z",key:"1rdhi6"}],["path",{d:"M7.47 8.53 9 7l1.53 1.53a3.5 3.5 0 0 1 0 4.94L9 15l-1.53-1.53a3.5 3.5 0 0 1 0-4.94Z",key:"1sdzmb"}],["path",{d:"M11.47 4.53 13 3l1.53 1.53a3.5 3.5 0 0 1 0 4.94L13 11l-1.53-1.53a3.5 3.5 0 0 1 0-4.94Z",key:"eoatbi"}],["path",{d:"M20 2h2v2a4 4 0 0 1-4 4h-2V6a4 4 0 0 1 4-4Z",key:"19rau1"}],["path",{d:"M11.47 17.47 13 19l-1.53 1.53a3.5 3.5 0 0 1-4.94 0L5 19l1.53-1.53a3.5 3.5 0 0 1 4.94 0Z",key:"tc8ph9"}],["path",{d:"M15.47 13.47 17 15l-1.53 1.53a3.5 3.5 0 0 1-4.94 0L9 15l1.53-1.53a3.5 3.5 0 0 1 4.94 0Z",key:"2m8kc5"}],["path",{d:"M19.47 9.47 21 11l-1.53 1.53a3.5 3.5 0 0 1-4.94 0L13 11l1.53-1.53a3.5 3.5 0 0 1 4.94 0Z",key:"vex3ng"}]],On=E("wheat",Er);function oa({className:e,type:t,...n}){return an.jsx("input",{type:t,"data-slot":"input",className:hr("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",e),...n})}function R(e){if(typeof e=="number")return(Math.abs(e*2654435761)>>>0).toString(16);if(typeof e=="boolean")return e?"1":"0";if(e===null)return"null";if(e===void 0)return"undefined";if(typeof e=="string"){let t=2166136261;for(let n=0;n<e.length;n++)t^=e.charCodeAt(n),t+=(t<<1)+(t<<4)+(t<<7)+(t<<8)+(t<<24),t=t>>>0;return t.toString(16)}if(Array.isArray(e)){let t=2166136261;for(let n=0;n<e.length;n++){t^=(n+1)*2654435761;const r=R(e[n]);for(let i=0;i<r.length;i++)t^=r.charCodeAt(i),t*=16777619,t=t>>>0}return t.toString(16)}if(typeof e=="object"){let t=2166136261;const n=Object.keys(e).sort();for(let r=0;r<n.length;r++){const i=n[r],s=R(i);t^=parseInt(s,16),t*=16777619,t=t>>>0;const o=R(e[i]);t^=parseInt(o,16),t*=16777619,t=t>>>0}return t.toString(16)}return R(String(e))}const j={Remove:"remove",Replace:"replace",Add:"add"},kn=Symbol.for("__MUTATIVE_PROXY_DRAFT__"),Pr=Symbol("__MUTATIVE_RAW_RETURN_SYMBOL__"),$e=Symbol.iterator,q={mutable:"mutable",immutable:"immutable"},dt={};function ye(e,t){return e instanceof Map?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function Tt(e,t){if(t in e){let n=Reflect.getPrototypeOf(e);for(;n;){const r=Reflect.getOwnPropertyDescriptor(n,t);if(r)return r;n=Reflect.getPrototypeOf(n)}}}function lt(e){return Object.getPrototypeOf(e)===Set.prototype}function ft(e){return Object.getPrototypeOf(e)===Map.prototype}function N(e){var t;return(t=e.copy)!==null&&t!==void 0?t:e.original}function ne(e){return!!g(e)}function g(e){return typeof e!="object"?null:e==null?void 0:e[kn]}function ht(e){var t;const n=g(e);return n?(t=n.copy)!==null&&t!==void 0?t:n.original:e}function V(e,t){if(!e||typeof e!="object")return!1;let n;return Object.getPrototypeOf(e)===Object.prototype||Array.isArray(e)||e instanceof Map||e instanceof Set||!!(t!=null&&t.mark)&&((n=t.mark(e,q))===q.immutable||typeof n=="function")}function Sn(e,t=[]){if(Object.hasOwnProperty.call(e,"key")){const n=e.parent.copy,r=g(G(n,e.key));if(r!==null&&(r==null?void 0:r.original)!==e.original)return null;const i=e.parent.type===3,s=i?Array.from(e.parent.setMap.keys()).indexOf(e.key):e.key;if(!(i&&n.size>s||ye(n,s)))return null;t.push(s)}if(e.parent)return Sn(e.parent,t);t.reverse();try{xr(e.copy,t)}catch{return null}return t}function re(e){return Array.isArray(e)?1:e instanceof Map?2:e instanceof Set?3:0}function G(e,t){return re(e)===2?e.get(t):e[t]}function ge(e,t,n){re(e)===2?e.set(t,n):e[t]=n}function Ue(e,t){const n=g(e);return(n?N(n):e)[t]}function Z(e,t){return e===t?e!==0||1/e===1/t:e!==e&&t!==t}function We(e){if(e)for(;e.finalities.revoke.length>0;)e.finalities.revoke.pop()()}function ee(e,t){return t?e:[""].concat(e).map(n=>{const r=`${n}`;return r.indexOf("/")===-1&&r.indexOf("~")===-1?r:r.replace(/~/g,"~0").replace(/\//g,"~1")}).join("/")}function xr(e,t){for(let n=0;n<t.length-1;n+=1){const r=t[n];if(e=G(re(e)===3?Array.from(e):e,r),typeof e!="object")throw new Error(`Cannot resolve patch at '${t.join("/")}'.`)}return e}function Cr(e){const t=Object.create(Object.getPrototypeOf(e));return Reflect.ownKeys(e).forEach(n=>{let r=Reflect.getOwnPropertyDescriptor(e,n);if(r.enumerable&&r.configurable&&r.writable){t[n]=e[n];return}r.writable||(r.writable=!0,r.configurable=!0),(r.get||r.set)&&(r={configurable:!0,writable:!0,enumerable:r.enumerable,value:e[n]}),Reflect.defineProperty(t,n,r)}),t}const Rr=Object.prototype.propertyIsEnumerable;function jn(e,t){let n;if(Array.isArray(e))return Array.prototype.concat.call(e);if(e instanceof Set){if(!lt(e)){const r=Object.getPrototypeOf(e).constructor;return new r(e.values())}return Set.prototype.difference?Set.prototype.difference.call(e,new Set):new Set(e.values())}else if(e instanceof Map){if(!ft(e)){const r=Object.getPrototypeOf(e).constructor;return new r(e)}return new Map(e)}else if(t!=null&&t.mark&&(n=t.mark(e,q),n!==void 0)&&n!==q.mutable){if(n===q.immutable)return Cr(e);if(typeof n=="function"){if(t.enablePatches||t.enableAutoFreeze)throw new Error("You can't use mark and patches or auto freeze together.");return n()}throw new Error(`Unsupported mark result: ${n}`)}else if(typeof e=="object"&&Object.getPrototypeOf(e)===Object.prototype){const r={};return Object.keys(e).forEach(i=>{r[i]=e[i]}),Object.getOwnPropertySymbols(e).forEach(i=>{Rr.call(e,i)&&(r[i]=e[i])}),r}else throw new Error("Please check mark() to ensure that it is a stable marker draftable function.")}function x(e){e.copy||(e.copy=jn(e.original,e.options))}function he(e){if(!V(e))return ht(e);if(Array.isArray(e))return e.map(he);if(e instanceof Map){const n=Array.from(e.entries()).map(([r,i])=>[r,he(i)]);if(!ft(e)){const r=Object.getPrototypeOf(e).constructor;return new r(n)}return new Map(n)}if(e instanceof Set){const n=Array.from(e).map(he);if(!lt(e)){const r=Object.getPrototypeOf(e).constructor;return new r(n)}return new Set(n)}const t=Object.create(Object.getPrototypeOf(e));for(const n in e)t[n]=he(e[n]);return t}function Ae(e){return ne(e)?he(e):e}function B(e){var t;e.assignedMap=(t=e.assignedMap)!==null&&t!==void 0?t:new Map,e.operated||(e.operated=!0,e.parent&&B(e.parent))}function Et(){throw new Error("Cannot modify frozen object")}function oe(e,t,n,r,i){{n=n??new WeakMap,r=r??[],i=i??[];const o=n.has(e)?n.get(e):e;if(r.length>0){const a=r.indexOf(o);if(o&&typeof o=="object"&&a!==-1)throw r[0]===o?new Error("Forbids circular reference"):new Error(`Forbids circular reference: ~/${i.slice(0,a).map((c,u)=>{if(typeof c=="symbol")return`[${c.toString()}]`;const d=r[u];return typeof c=="object"&&(d instanceof Map||d instanceof Set)?Array.from(d.keys()).indexOf(c):c}).join("/")}`);r.push(o),i.push(t)}else r.push(o)}if(Object.isFrozen(e)||ne(e)){r.pop(),i.pop();return}switch(re(e)){case 2:for(const[a,c]of e)oe(a,a,n,r,i),oe(c,a,n,r,i);e.set=e.clear=e.delete=Et;break;case 3:for(const a of e)oe(a,a,n,r,i);e.add=e.clear=e.delete=Et;break;case 1:Object.freeze(e);let o=0;for(const a of e)oe(a,o,n,r,i),o+=1;break;default:Object.freeze(e),Object.keys(e).forEach(a=>{const c=e[a];oe(c,a,n,r,i)})}r.pop(),i.pop()}function pt(e,t){const n=re(e);if(n===0)Reflect.ownKeys(e).forEach(r=>{t(r,e[r],e)});else if(n===1){let r=0;for(const i of e)t(r,i,e),r+=1}else e.forEach((r,i)=>t(i,r,e))}function Mn(e,t,n){if(ne(e)||!V(e,n)||t.has(e)||Object.isFrozen(e))return;const r=e instanceof Set,i=r?new Map:void 0;if(t.add(e),pt(e,(s,o)=>{var a;if(ne(o)){const c=g(o);x(c);const u=!((a=c.assignedMap)===null||a===void 0)&&a.size||c.operated?c.copy:c.original;ge(r?i:e,s,u)}else Mn(o,t,n)}),i){const s=e,o=Array.from(s);s.clear(),o.forEach(a=>{s.add(i.has(a)?i.get(a):a)})}}function Dr(e,t){const n=e.type===3?e.setMap:e.copy;e.finalities.revoke.length>1&&e.assignedMap.get(t)&&n&&Mn(G(n,t),e.finalities.handledSet,e.options)}function Be(e){e.type===3&&e.copy&&(e.copy.clear(),e.setMap.forEach(t=>{e.copy.add(ht(t))}))}function Je(e,t,n,r){if(e.operated&&e.assignedMap&&e.assignedMap.size>0&&!e.finalized){if(n&&r){const s=Sn(e);s&&t(e,s,n,r)}e.finalized=!0}}function yt(e,t,n,r){const i=g(n);i&&(i.callbacks||(i.callbacks=[]),i.callbacks.push((s,o)=>{var a;const c=e.type===3?e.setMap:e.copy;if(Z(G(c,t),n)){let u=i.original;i.copy&&(u=i.copy),Be(e),Je(e,r,s,o),e.options.enableAutoFreeze&&(e.options.updatedValues=(a=e.options.updatedValues)!==null&&a!==void 0?a:new WeakMap,e.options.updatedValues.set(u,i.original)),ge(c,t,u)}}),e.options.enableAutoFreeze&&i.finalities!==e.finalities&&(e.options.enableAutoFreeze=!1)),V(n,e.options)&&e.finalities.draft.push(()=>{const s=e.type===3?e.setMap:e.copy;Z(G(s,t),n)&&Dr(e,t)})}function Ur(e,t,n,r,i){let{original:s,assignedMap:o,options:a}=e,c=e.copy;c.length<s.length&&([s,c]=[c,s],[n,r]=[r,n]);for(let u=0;u<s.length;u+=1)if(o.get(u.toString())&&c[u]!==s[u]){const d=t.concat([u]),l=ee(d,i);n.push({op:j.Replace,path:l,value:Ae(c[u])}),r.push({op:j.Replace,path:l,value:Ae(s[u])})}for(let u=s.length;u<c.length;u+=1){const d=t.concat([u]),l=ee(d,i);n.push({op:j.Add,path:l,value:Ae(c[u])})}if(s.length<c.length){const{arrayLengthAssignment:u=!0}=a.enablePatches;if(u){const d=t.concat(["length"]),l=ee(d,i);r.push({op:j.Replace,path:l,value:s.length})}else for(let d=c.length;s.length<d;d-=1){const l=t.concat([d-1]),f=ee(l,i);r.push({op:j.Remove,path:f})}}}function Lr({original:e,copy:t,assignedMap:n},r,i,s,o){n.forEach((a,c)=>{const u=G(e,c),d=Ae(G(t,c)),l=a?ye(e,c)?j.Replace:j.Add:j.Remove;if(Z(u,d)&&l===j.Replace)return;const f=r.concat(c),h=ee(f,o);i.push(l===j.Remove?{op:l,path:h}:{op:l,path:h,value:d}),s.push(l===j.Add?{op:j.Remove,path:h}:l===j.Remove?{op:j.Add,path:h,value:u}:{op:j.Replace,path:h,value:u})})}function Nr({original:e,copy:t},n,r,i,s){let o=0;e.forEach(a=>{if(!t.has(a)){const c=n.concat([o]),u=ee(c,s);r.push({op:j.Remove,path:u,value:a}),i.unshift({op:j.Add,path:u,value:a})}o+=1}),o=0,t.forEach(a=>{if(!e.has(a)){const c=n.concat([o]),u=ee(c,s);r.push({op:j.Add,path:u,value:a}),i.unshift({op:j.Remove,path:u,value:a})}o+=1})}function ve(e,t,n,r){const{pathAsArray:i=!0}=e.options.enablePatches;switch(e.type){case 0:case 2:return Lr(e,t,n,r,i);case 1:return Ur(e,t,n,r,i);case 3:return Nr(e,t,n,r,i)}}const Te=(e,t,n=!1)=>{if(typeof e=="object"&&e!==null&&(!V(e,t)||n))throw new Error("Strict mode: Mutable data cannot be accessed directly, please use 'unsafe(callback)' wrap.")},He={get size(){return N(g(this)).size},has(e){return N(g(this)).has(e)},set(e,t){const n=g(this),r=N(n);return(!r.has(e)||!Z(r.get(e),t))&&(x(n),B(n),n.assignedMap.set(e,!0),n.copy.set(e,t),yt(n,e,t,ve)),this},delete(e){if(!this.has(e))return!1;const t=g(this);return x(t),B(t),t.original.has(e)?t.assignedMap.set(e,!1):t.assignedMap.delete(e),t.copy.delete(e),!0},clear(){const e=g(this);if(this.size){x(e),B(e),e.assignedMap=new Map;for(const[t]of e.original)e.assignedMap.set(t,!1);e.copy.clear()}},forEach(e,t){const n=g(this);N(n).forEach((r,i)=>{e.call(t,this.get(i),i,this)})},get(e){var t,n;const r=g(this),i=N(r).get(e),s=((n=(t=r.options).mark)===null||n===void 0?void 0:n.call(t,i,q))===q.mutable;if(r.options.strict&&Te(i,r.options,s),s||r.finalized||!V(i,r.options)||i!==r.original.get(e))return i;const o=dt.createDraft({original:i,parentDraft:r,key:e,finalities:r.finalities,options:r.options});return x(r),r.copy.set(e,o),o},keys(){return N(g(this)).keys()},values(){const e=this.keys();return{[$e]:()=>this.values(),next:()=>{const t=e.next();return t.done?t:{done:!1,value:this.get(t.value)}}}},entries(){const e=this.keys();return{[$e]:()=>this.entries(),next:()=>{const t=e.next();if(t.done)return t;const n=this.get(t.value);return{done:!1,value:[t.value,n]}}}},[$e](){return this.entries()}},qr=Reflect.ownKeys(He),Pt=(e,t,{isValuesIterator:n})=>()=>{var r,i;const s=t.next();if(s.done)return s;const o=s.value;let a=e.setMap.get(o);const c=g(a),u=((i=(r=e.options).mark)===null||i===void 0?void 0:i.call(r,a,q))===q.mutable;if(e.options.strict&&Te(o,e.options,u),!u&&!c&&V(o,e.options)&&!e.finalized&&e.original.has(o)){const d=dt.createDraft({original:o,parentDraft:e,key:o,finalities:e.finalities,options:e.options});e.setMap.set(o,d),a=d}else c&&(a=c.proxy);return{done:!1,value:n?a:[a,a]}},Ee={get size(){return g(this).setMap.size},has(e){const t=g(this);if(t.setMap.has(e))return!0;x(t);const n=g(e);return!!(n&&t.setMap.has(n.original))},add(e){const t=g(this);return this.has(e)||(x(t),B(t),t.assignedMap.set(e,!0),t.setMap.set(e,e),yt(t,e,e,ve)),this},delete(e){if(!this.has(e))return!1;const t=g(this);x(t),B(t);const n=g(e);return n&&t.setMap.has(n.original)?(t.assignedMap.set(n.original,!1),t.setMap.delete(n.original)):(!n&&t.setMap.has(e)?t.assignedMap.set(e,!1):t.assignedMap.delete(e),t.setMap.delete(e))},clear(){if(!this.size)return;const e=g(this);x(e),B(e);for(const t of e.original)e.assignedMap.set(t,!1);e.setMap.clear()},values(){const e=g(this);x(e);const t=e.setMap.keys();return{[Symbol.iterator]:()=>this.values(),next:Pt(e,t,{isValuesIterator:!0})}},entries(){const e=g(this);x(e);const t=e.setMap.keys();return{[Symbol.iterator]:()=>this.entries(),next:Pt(e,t,{isValuesIterator:!1})}},keys(){return this.values()},[$e](){return this.values()},forEach(e,t){const n=this.values();let r=n.next();for(;!r.done;)e.call(t,r.value,r.value,this),r=n.next()}};Set.prototype.difference&&Object.assign(Ee,{intersection(e){return Set.prototype.intersection.call(new Set(this.values()),e)},union(e){return Set.prototype.union.call(new Set(this.values()),e)},difference(e){return Set.prototype.difference.call(new Set(this.values()),e)},symmetricDifference(e){return Set.prototype.symmetricDifference.call(new Set(this.values()),e)},isSubsetOf(e){return Set.prototype.isSubsetOf.call(new Set(this.values()),e)},isSupersetOf(e){return Set.prototype.isSupersetOf.call(new Set(this.values()),e)},isDisjointFrom(e){return Set.prototype.isDisjointFrom.call(new Set(this.values()),e)}});const zr=Reflect.ownKeys(Ee),$n=new WeakSet,An={get(e,t,n){var r,i;const s=(r=e.copy)===null||r===void 0?void 0:r[t];if(s&&$n.has(s))return s;if(t===kn)return e;let o;if(e.options.mark){const u=t==="size"&&(e.original instanceof Map||e.original instanceof Set)?Reflect.get(e.original,t):Reflect.get(e.original,t,n);if(o=e.options.mark(u,q),o===q.mutable)return e.options.strict&&Te(u,e.options,!0),u}const a=N(e);if(a instanceof Map&&qr.includes(t)){if(t==="size")return Object.getOwnPropertyDescriptor(He,"size").get.call(e.proxy);const u=He[t];if(u)return u.bind(e.proxy)}if(a instanceof Set&&zr.includes(t)){if(t==="size")return Object.getOwnPropertyDescriptor(Ee,"size").get.call(e.proxy);const u=Ee[t];if(u)return u.bind(e.proxy)}if(!ye(a,t)){const u=Tt(a,t);return u?"value"in u?u.value:(i=u.get)===null||i===void 0?void 0:i.call(e.proxy):void 0}const c=a[t];if(e.options.strict&&Te(c,e.options),e.finalized||!V(c,e.options))return c;if(c===Ue(e.original,t)){if(x(e),e.copy[t]=bt({original:e.original[t],parentDraft:e,key:e.type===1?Number(t):t,finalities:e.finalities,options:e.options}),typeof o=="function"){const u=g(e.copy[t]);return x(u),B(u),u.copy}return e.copy[t]}return c},set(e,t,n){var r;if(e.type===3||e.type===2)throw new Error("Map/Set draft does not support any property assignment.");let i;if(e.type===1&&t!=="length"&&!(Number.isInteger(i=Number(t))&&i>=0&&(t===0||i===0||String(i)===String(t))))throw new Error("Only supports setting array indices and the 'length' property.");const s=Tt(N(e),t);if(s!=null&&s.set)return s.set.call(e.proxy,n),!0;const o=Ue(N(e),t),a=g(o);return a&&Z(a.original,n)?(e.copy[t]=n,e.assignedMap=(r=e.assignedMap)!==null&&r!==void 0?r:new Map,e.assignedMap.set(t,!1),!0):(Z(n,o)&&(n!==void 0||ye(e.original,t))||(x(e),B(e),ye(e.original,t)&&Z(n,e.original[t])?e.assignedMap.delete(t):e.assignedMap.set(t,!0),e.copy[t]=n,yt(e,t,n,ve)),!0)},has(e,t){return t in N(e)},ownKeys(e){return Reflect.ownKeys(N(e))},getOwnPropertyDescriptor(e,t){const n=N(e),r=Reflect.getOwnPropertyDescriptor(n,t);return r&&{writable:!0,configurable:e.type!==1||t!=="length",enumerable:r.enumerable,value:n[t]}},getPrototypeOf(e){return Reflect.getPrototypeOf(e.original)},setPrototypeOf(){throw new Error("Cannot call 'setPrototypeOf()' on drafts")},defineProperty(){throw new Error("Cannot call 'defineProperty()' on drafts")},deleteProperty(e,t){var n;return e.type===1?An.set.call(this,e,t,void 0,e.proxy):(Ue(e.original,t)!==void 0||t in e.original?(x(e),B(e),e.assignedMap.set(t,!1)):(e.assignedMap=(n=e.assignedMap)!==null&&n!==void 0?n:new Map,e.assignedMap.delete(t)),e.copy&&delete e.copy[t],!0)}};function bt(e){const{original:t,parentDraft:n,key:r,finalities:i,options:s}=e,o=re(t),a={type:o,finalized:!1,parent:n,original:t,copy:null,proxy:null,finalities:i,options:s,setMap:o===3?new Map(t.entries()):void 0};(r||"key"in e)&&(a.key=r);const{proxy:c,revoke:u}=Proxy.revocable(o===1?Object.assign([],a):a,An);if(i.revoke.push(u),$n.add(c),a.proxy=c,n){const d=n;d.finalities.draft.push((l,f)=>{var h,p;const y=g(c);let v=d.type===3?d.setMap:d.copy;const b=G(v,r),_=g(b);if(_){let m=_.original;_.operated&&(m=ht(b)),Be(_),Je(_,ve,l,f),d.options.enableAutoFreeze&&(d.options.updatedValues=(h=d.options.updatedValues)!==null&&h!==void 0?h:new WeakMap,d.options.updatedValues.set(m,_.original)),ge(v,r,m)}(p=y.callbacks)===null||p===void 0||p.forEach(m=>{m(l,f)})})}else{const d=g(c);d.finalities.draft.push((l,f)=>{Be(d),Je(d,ve,l,f)})}return c}dt.createDraft=bt;function Fr(e,t,n,r,i){var s;const o=g(e),a=(s=o==null?void 0:o.original)!==null&&s!==void 0?s:e,c=!!t.length;if(o!=null&&o.operated)for(;o.finalities.draft.length>0;)o.finalities.draft.pop()(n,r);const u=c?t[0]:o?o.operated?o.copy:o.original:e;return o&&We(o),i&&oe(u,u,o==null?void 0:o.options.updatedValues),[u,n&&c?[{op:j.Replace,path:[],value:t[0]}]:n,r&&c?[{op:j.Replace,path:[],value:a}]:r]}function Vr(e,t){var n;const r={draft:[],revoke:[],handledSet:new WeakSet};let i,s;t.enablePatches&&(i=[],s=[]);const a=((n=t.mark)===null||n===void 0?void 0:n.call(t,e,q))===q.mutable||!V(e,t)?e:bt({original:e,parentDraft:null,finalities:r,options:t});return[a,(c=[])=>{const[u,d,l]=Fr(a,c,i,s,t.enableAutoFreeze);return t.enablePatches?[u,d,l]:u}]}function Ke(e){const{rootDraft:t,value:n,useRawReturn:r=!1,isRoot:i=!0}=e;pt(n,(s,o,a)=>{const c=g(o);if(c&&t&&c.finalities===t.finalities){e.isContainDraft=!0;const u=c.original;if(a instanceof Set){const d=Array.from(a);a.clear(),d.forEach(l=>a.add(s===l?u:l))}else ge(a,s,u)}else typeof o=="object"&&o!==null&&(e.value=o,e.isRoot=!1,Ke(e))}),i&&(e.isContainDraft||console.warn("The return value does not contain any draft, please use 'rawReturn()' to wrap the return value to improve performance."),r&&console.warn("The return value contains drafts, please don't use 'rawReturn()' to wrap the return value."))}function In(e){var t;const n=g(e);if(!V(e,n==null?void 0:n.options))return e;const r=re(e);if(n&&!n.operated)return n.original;let i;function s(){i=r===2?ft(e)?new Map(e):new(Object.getPrototypeOf(e)).constructor(e):r===3?Array.from(n.setMap.values()):jn(e,n==null?void 0:n.options)}if(n){n.finalized=!0;try{s()}finally{n.finalized=!1}}else i=e;if(pt(i,(o,a)=>{if(n&&Z(G(n.original,o),a))return;const c=In(a);c!==a&&(i===e&&s(),ge(i,o,c))}),r===3){const o=(t=n==null?void 0:n.original)!==null&&t!==void 0?t:i;return lt(o)?new Set(i):new(Object.getPrototypeOf(o)).constructor(i)}return i}function xt(e){if(!ne(e))throw new Error(`current() is only used for Draft, parameter: ${e}`);return In(e)}const Qr=e=>function t(n,r,i){var s,o,a;if(typeof n=="function"&&typeof r!="function")return function(w,...C){return t(w,$=>n.call(this,$,...C),r)};const c=n,u=r;let d=i;if(typeof r!="function"&&(d=r),d!==void 0&&Object.prototype.toString.call(d)!=="[object Object]")throw new Error(`Invalid options: ${d}, 'options' should be an object.`);d=Object.assign(Object.assign({},e),d);const l=ne(c)?xt(c):c,f=Array.isArray(d.mark)?(w,C)=>{for(const $ of d.mark){if(typeof $!="function")throw new Error(`Invalid mark: ${$}, 'mark' should be a function.`);const Q=$(w,C);if(Q)return Q}}:d.mark,h=(s=d.enablePatches)!==null&&s!==void 0?s:!1,p=(o=d.strict)!==null&&o!==void 0?o:!1,v={enableAutoFreeze:(a=d.enableAutoFreeze)!==null&&a!==void 0?a:!1,mark:f,strict:p,enablePatches:h};if(!V(l,v)&&typeof l=="object"&&l!==null)throw new Error("Invalid base state: create() only supports plain objects, arrays, Set, Map or using mark() to mark the state as immutable.");const[b,_]=Vr(l,v);if(typeof r!="function"){if(!V(l,v))throw new Error("Invalid base state: create() only supports plain objects, arrays, Set, Map or using mark() to mark the state as immutable.");return[b,_]}let m;try{m=u(b)}catch(w){throw We(g(b)),w}const P=w=>{const C=g(b);if(!ne(w)){if(w!==void 0&&!Z(w,b)&&(C!=null&&C.operated))throw new Error("Either the value is returned as a new non-draft value, or only the draft is modified without returning any value.");const Q=w==null?void 0:w[Pr];if(Q){const jt=Q[0];return v.strict&&typeof w=="object"&&w!==null&&Ke({rootDraft:C,value:w,useRawReturn:!0}),_([jt])}if(w!==void 0)return typeof w=="object"&&w!==null&&Ke({rootDraft:C,value:w}),_([w])}if(w===b||w===void 0)return _([]);const $=g(w);if(v===$.options){if($.operated)throw new Error("Cannot return a modified child draft.");return _([xt(w)])}return _([w])};return m instanceof Promise?m.then(P,w=>{throw We(g(b)),w}):P(m)},Ze=Qr();Object.prototype.constructor.toString();function Tn(e,t){const n=Object.keys(e),r=Object.keys(t);return n.length===r.length&&Object.keys(e).every(i=>t.hasOwnProperty(i))}function Ct(e,t){return Object.keys(e).length===Object.keys(t).length&&Object.keys(e).every(n=>t.hasOwnProperty(n)&&e[n]===t[n])}function Ie(e,t){return typeof e!="object"||typeof t!="object"||e===null||t===null?e===t:Tn(e,t)?Object.keys(e).every(n=>Ie(e[n],t[n])):!1}function vt(e){if(!pe(e))return e;const t={};for(const[n,r]of Object.entries(e))r!==void 0&&(t[n]=r);return t}function En(e,t){if(!pe(e)||!pe(t))return t;const n=Object.assign({},e);for(const r of Object.keys(t)){if(t[r]===void 0)continue;if(t[r]===null){delete n[r];continue}const i=pe(e[r])&&pe(t[r]);n[r]=i?En(e[r],t[r]):t[r]}return n}function pe(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}function Wr(e,t,n){if(!e||t.length===0)return;let r=e||{};for(let s=0;s<t.length-1;s++){const o=t[s];(!(o in r)||typeof r[o]!="object")&&(r[o]=typeof t[s+1]=="number"?[]:{}),r=r[o]}const i=t[t.length-1];Array.isArray(r)&&typeof i=="number"?r.splice(i,0,n):r[i]=n}function Rt(e,t,n){if(!e||t.length===0)return;let r=e||{};for(let i=0;i<t.length-1;i++){const s=t[i];(!(s in r)||typeof r[s]!="object")&&(r[s]=typeof t[i+1]=="number"?[]:{}),r=r[s]}r[t[t.length-1]]=n}function Pn(e,t){if(!e||t.length===0)return;const[n,...r]=t;if(n in e){if(r.length===0){Array.isArray(e)?e.splice(n,1):delete e[n];return}Pn(e[n],r),Br(e[n])&&delete e[n]}}function Br(e){return e&&Object.keys(e).length===0}function Jr(e){return new Date(e)}function Hr(e){return new Date(e+"Z")}function Kr(e){return new Date(e+"T00:00:00Z")}function Zr(e){const[t,n]=e.split(" ");return new Date(t+"T"+n+"Z")}function Gr(e){const[t,n]=e.split(" ");return new Date(t+"T"+n+"Z")}function Yr(e){return new Date(e)}function Xr(e){const t=/^(\w{3}) (\w{3}) (\d{2}) (\d{4})$/;if(!e.match(t))throw new Error(`Unable to parse \`${e}\` as a date.`);const r=new Date(e+" UTC");return new Date(Date.UTC(r.getUTCFullYear(),r.getUTCMonth(),r.getUTCDate(),0,0,0,0))}function ei(e){const t=/^(.+T.+)([+-])(\d{2})$/,n=e.match(t);if(n){const[,r,i,s]=n,o=`${r}${i}${s}:00`;return new Date(o)}return null}function ti(e){const[t,n]=e.split(", "),[r,i,s]=t.split("/").map(Number),o=n.match(/(\d{1,2}):(\d{2}):(\d{2}) (AM|PM)/);if(!o)throw new Error(`Unable to parse time from: ${e}`);let[,a,c,u,d]=o;return a=Number(a),c=Number(c),u=Number(u),d==="PM"&&a!==12?a+=12:d==="AM"&&a===12&&(a=0),new Date(Date.UTC(s,r-1,i,a,c,u))}const ni=[Gr,Xr,ti,Yr,Kr,Hr,Jr,ei,Zr];function ri(e,t){try{const n=e(t);return n instanceof Date&&!isNaN(n.getTime())?n:null}catch{return null}}function xn(e){for(const t of ni){const n=ri(t,e);if(n)return n}return null}function ii(e){try{const t=JSON.parse(e);return typeof t=="string"?xn(t):null}catch{return null}}function xe(e){if(e instanceof Date)return e;if(typeof e=="string"){const t=xn(e)||ii(e);if(!t)throw new Error(`Unable to parse \`${e}\` as a date.`);return t}else if(typeof e=="number")return new Date(e);throw new Error(`Invalid date value \`${e}\`. Expected a date, number, or string, got type ${typeof e}.`)}function si(e){return e.cardinality==="one"}function _t(e){return e["value-type"]==="ref"}function gt(e){return e["value-type"]==="blob"}function we(e,t){return e[t]}function Ce(e,t){return t.reduce((n,r)=>n&&n.get(r),e)}function F(e,t){if(t.length===0)throw new Error("path must have at least one element");if(t.length===1){e.delete(t[0]);return}const[n,...r]=t;e.has(n)&&F(e.get(n),r)}function D(e,t,n){if(t.length===0)throw new Error("path must have at least one element");if(t.length===1){e.set(t[0],n);return}const[r,...i]=t;let s=e.get(r);s||(s=new Map,e.set(r,s)),D(s,i,n)}function Cn(e,t,n){const r=new Map,i=new Map,s=new Map;for(const o of t){let[a,c,u,d]=o;const l=we(e,c);if(!l){console.warn("no such attr",a,e);continue}l["checked-data-type"]==="date"&&n&&(u=xe(u),o[2]=u),_t(l)&&D(s,[u,c,a],o),D(r,[a,c,u],o),D(i,[c,a,u],o)}return{eav:r,aev:i,vae:s}}function Rn(e){const t=new Map,n=new Map,r=new Map,i=new Map;for(const s of Object.values(e)){const o=s["forward-identity"],[a,c,u]=o,d=s["reverse-identity"];if(D(r,[c,u],s),gt(s)&&D(t,[c,u],s),s["primary?"]&&D(n,[c],s),d){const[l,f,h]=d;D(i,[f,h],s)}}return{blobAttrs:t,primaryKeys:n,forwardIdents:r,revIdents:i}}function oi(e){return{__type:e.__type,attrs:e.attrs,triples:U(e.eav,3),cardinalityInference:e.cardinalityInference,linkIndex:e.linkIndex,useDateObjects:e.useDateObjects}}function ai(e){return Ge(e.attrs,e.triples,e.cardinalityInference,e.linkIndex,e.useDateObjects)}function wt(e){e.attrIndexes=Rn(e.attrs)}function Ge(e,t,n,r,i){const s=Cn(e,t,i);return s.useDateObjects=i,s.attrs=e,s.attrIndexes=Rn(e),s.cardinalityInference=n,s.linkIndex=r,s.__type="store",s}function me(e,t){var n,r;let i;if(Array.isArray(t[0])){const[o,a]=t[0],c=e.aev.get(o);if(!c)return null;i=(n=U(c,2).find(d=>d[2]===a))===null||n===void 0?void 0:n[0]}else i=t[0];if(!i)return null;const s=t[2];if(Array.isArray(s)&&s.length===2&&e.aev.get(s[0])){const[o,a]=s,c=e.aev.get(o);if(!c)return null;const d=(r=U(c,2).find(y=>y[2]===a))===null||r===void 0?void 0:r[0];if(!d)return null;const[l,f,h,...p]=t;return[i,f,d,...p]}else{const[o,...a]=t;return[i,...a]}}function ci(e,t){const n=me(e,t);if(!n)return;const[r,i,s]=n,o=we(e.attrs,i);o&&(F(e.eav,[r,i,s]),F(e.aev,[i,r,s]),_t(o)&&F(e.vae,[s,i,r]))}let ui=0;function Dn(e,t,n){const[r,i,s]=n;let o;const a=Ce(e.ea,[r,i,s]);return a&&(o=a[3]),o||Date.now()*10+ui++}function di(e,t){var n;const r=me(e,t);if(!r)return;let[i,s,o]=r;const a=we(e.attrs,s);if(!a)return;a["checked-data-type"]==="date"&&e.useDateObjects&&(o=xe(o));const c=Ce(e.eav,[i,s,o]),u=(n=c==null?void 0:c[3])!==null&&n!==void 0?n:Dn(e,a,r),d=[i,s,o,u];si(a)?(D(e.eav,[i,s],new Map([[o,d]])),D(e.aev,[s,i],new Map([[o,d]]))):(D(e.eav,[i,s,o],d),D(e.aev,[s,i,o],d)),_t(a)&&D(e.vae,[o,s,i],d)}function li(e,t){var n;const r=me(e,t);if(!r)return;const[i,s,o]=r,a=we(e.attrs,s);if(!a)return;if(!gt(a))throw new Error("merge operation is not supported for links");const c=Ce(e.eav,[i,s]);if(!c)return;const u=(n=c.values().next())===null||n===void 0?void 0:n.value;if(!u)return;const d=u[2],l=En(d,o),f=[i,s,l,Dn(e,a,u)];D(e.eav,[i,s],new Map([[l,f]]))}function Ye(e,t){var n,r;const[i,s]=t,o=me(e,[i]);if(!o)return;const[a]=o,c=e.eav.get(a);if(c){for(const d of c.keys()){const l=e.attrs[d];l&&l["on-delete-reverse"]==="cascade"&&U(c.get(d),1).forEach(([f,h,p])=>{var y;return Ye(e,[p,(y=l["reverse-identity"])===null||y===void 0?void 0:y[1]])}),(!s||!l||((n=l["forward-identity"])===null||n===void 0?void 0:n[1])===s)&&(F(e.aev,[d,a]),F(e.eav,[a,d]))}c.size===0&&F(e.eav,[a])}const u=e.vae.get(a)&&U(e.vae.get(a),2);u&&u.forEach(d=>{var l,f,h;const[p,y,v]=d,b=e.attrs[y];(!s||!b||((l=b["reverse-identity"])===null||l===void 0?void 0:l[1])===s)&&(F(e.eav,[p,y,v]),F(e.aev,[y,p,v]),F(e.vae,[v,y,p])),b&&b["on-delete"]==="cascade"&&((f=b["reverse-identity"])===null||f===void 0?void 0:f[1])===s&&Ye(e,[p,(h=b["forward-identity"])===null||h===void 0?void 0:h[1]])}),((r=e.vae.get(a))===null||r===void 0?void 0:r.size)===0&&F(e.vae,[a])}function Un(e,t){const n=Cn(e.attrs,t,e.useDateObjects);Object.keys(n).forEach(r=>{e[r]=n[r]})}function fi(e,[t]){e.attrs[t.id]=t,wt(e)}function Ln(e){return U(e.eav,3)}function hi(e,[t]){if(!e.attrs[t])return;const n=Ln(e).filter(([r,i])=>i!==t);delete e.attrs[t],wt(e),Un(e,n)}function pi(e,[t]){const n=e.attrs[t.id];n&&(e.attrs[t.id]=Object.assign(Object.assign({},n),t),wt(e),Un(e,Ln(e)))}function yi(e,t){const[n,...r]=t;switch(n){case"add-triple":di(e,r);break;case"deep-merge-triple":li(e,r);break;case"retract-triple":ci(e,r);break;case"delete-entity":Ye(e,r);break;case"add-attr":fi(e,r);break;case"delete-attr":hi(e,r);break;case"update-attr":pi(e,r);break;case"rule-params":break;default:throw new Error(`unhandled transaction action: ${n}`)}}function U(e,t,n=[]){if(!e||t===0)return n;if(t===1){for(const r of e.values())n.push(r);return n}for(const r of e.values())U(r,t-1,n);return n}function Se(e,t,n){var r,i;const s=[];if(n!=null&&n.hasOwnProperty("$not")){for(const a of t.keys())n.$not!==a&&s.push(t.get(a));return s}if(n!=null&&n.hasOwnProperty("$isNull")){const{attrId:a,isNull:c,reverse:u}=n.$isNull;if(u)for(const d of t.keys()){const l=e.vae.get(d),f=!l||((r=l.get(a))===null||r===void 0?void 0:r.get(null))||!l.get(a);(c?f:!f)&&s.push(t.get(d))}else{const d=e.aev.get(a);for(const l of t.keys()){const f=!d||((i=d.get(l))===null||i===void 0?void 0:i.get(null))||!d.get(l);(c?f:!f)&&s.push(t.get(l))}}return s}if(n!=null&&n.$comparator)return U(t,1).filter(n.$op);const o=n.in||n.$in||[n];for(const a of o){const c=t.get(a);c&&s.push(c)}return s}function bi(e,t,n){let r="";return e!==void 0&&(r+="e"),t!==void 0&&(r+="a"),n!==void 0&&(r+="v"),r}function vi(e,[t,n,r]){var i,s;switch(bi(t,n,r)){case"e":{const a=e.eav.get(t);return U(a,2)}case"ea":{const a=(i=e.eav.get(t))===null||i===void 0?void 0:i.get(n);return U(a,1)}case"eav":{const a=(s=e.eav.get(t))===null||s===void 0?void 0:s.get(n);return a?Se(e,a,r):[]}case"ev":{const a=e.eav.get(t);if(!a)return[];const c=[];for(const u of a.values())c.push(...Se(e,u,r));return c}case"a":{const a=e.aev.get(n);return U(a,2)}case"av":{const a=e.aev.get(n);if(!a)return[];const c=[];for(const u of a.values())c.push(...Se(e,u,r));return c}case"v":{const a=[];for(const c of e.eav.values())for(const u of c.values())a.push(...Se(e,u,r));return a}default:return U(e.eav,3)}}function _i(e,t,n){var r;const i={};for(const[s,o]of t.entries()){const a=(r=e.eav.get(n))===null||r===void 0?void 0:r.get(o.id),c=U(a,1);for(const u of c)i[s]=u[2]}return i}function ce(e,t,n){var r;return(r=e.attrIndexes.forwardIdents.get(t))===null||r===void 0?void 0:r.get(n)}function Nn(e,t,n){var r;return(r=e.attrIndexes.revIdents.get(t))===null||r===void 0?void 0:r.get(n)}function gi(e,t){return e.attrIndexes.blobAttrs.get(t)}function wi(e,t){var n;const r=e.attrIndexes.primaryKeys.get(t);return r||((n=e.attrIndexes.forwardIdents.get(t))===null||n===void 0?void 0:n.get("id"))}function mi(e,t){const n=me(e,t);if(!n)return;const[r,i,s]=n;if(we(e.attrs,i))return Ce(e.eav,[r,i])}function Oi(e,t){const n=t.filter(([r,...i])=>{var s;if(r!=="add-triple"&&r!=="deep-merge-triple")return!0;const o=(s=i[3])===null||s===void 0?void 0:s.mode;if(o!=="create"&&o!=="update")return!0;const a=mi(e,i);return!(o==="create"&&a||o==="update"&&!a)});return Ze(e,r=>{n.forEach(i=>{yi(r,i)})})}function ki(e){return typeof e=="string"&&e.startsWith("?")}function Si(e,t,n){if(n.hasOwnProperty(e)){const r=n[e];return qn(r,t,n)}return Object.assign(Object.assign({},n),{[e]:t})}function Dt(e,t,n){return e===t?n:null}function ji(e){switch(typeof e){case"string":return e.startsWith("?")?Si:Dt;default:return Dt}}const Mi=["in","$in","$not","$isNull","$comparator"];function $i(e){for(const t of Mi)if(e.hasOwnProperty(t))return!0;return!1}function qn(e,t,n){return n?typeof e=="object"?$i(e)?n:null:ji(e)(e,t,n):null}function Ai(e,t,n){return e.reduce((r,i,s)=>{const o=t[s];return qn(i,o,r)},n)}function Ii(e,t,n){return Pi(e,t,n).map(r=>Ai(t,r,n)).filter(r=>r)}function Ti(e,t,n){return t.or?t.or.patterns.flatMap(r=>Xe(e,r,n)):t.and?t.and.patterns.reduce((r,i)=>Xe(e,i,r),n):n.flatMap(r=>Ii(e,t,r))}function Xe(e,t,n=[{}]){return t.reduce((r,i)=>Ti(e,i,r),n)}function mt(e,t){return Array.isArray(t)?t.map(n=>mt(e,n)):ki(t)?e[t]:t}function Ei(e,{find:t,where:n}){return Xe(e,n).map(i=>mt(i,t))}function Pi(e,t,n){return vi(e,mt(n,t))}const xi=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i;function ue(e){return typeof e=="string"&&xi.test(e)}const A=[];for(let e=0;e<256;++e)A.push((e+256).toString(16).slice(1));function Ci(e,t=0){return(A[e[t+0]]+A[e[t+1]]+A[e[t+2]]+A[e[t+3]]+"-"+A[e[t+4]]+A[e[t+5]]+"-"+A[e[t+6]]+A[e[t+7]]+"-"+A[e[t+8]]+A[e[t+9]]+"-"+A[e[t+10]]+A[e[t+11]]+A[e[t+12]]+A[e[t+13]]+A[e[t+14]]+A[e[t+15]]).toLowerCase()}let Le;const Ri=new Uint8Array(16);function Di(){if(!Le){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Le=crypto.getRandomValues.bind(crypto)}return Le(Ri)}const Ui=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Ut={randomUUID:Ui};function Li(e,t,n){var i;if(Ut.randomUUID&&!e)return Ut.randomUUID();e=e||{};const r=e.random??((i=e.rng)==null?void 0:i.call(e))??Di();if(r.length<16)throw new Error("Random bytes length must be >= 16");return r[6]=r[6]&15|64,r[8]=r[8]&63|128,Ci(r)}function Lt(e){const t=e.replace(/-/g,""),n=[];for(let r=0;r<t.length;r+=2)n.push(parseInt(t.substring(r,r+2),16));return n}function Ni(e,t){for(let n=0;n<e.length;n++){if(e[n]<t[n])return-1;if(e[n]>t[n])return 1}return 0}function qi(e,t){return Ni(Lt(e),Lt(t))}function I(){return Li()}let zi=0;function be(e){return Re(`_${e}`,zi++)}function Re(e,t){return`?${e}-${t}`}class de extends Error{constructor(t){super(t),this.name="AttrNotFoundError"}}function Fi(e,t){const n=wi(e,t);if(!n)throw new de(`Could not find id attr for ${t}`);return n}function Nt(e,t,n,r){return[Vi(e,t,n,r)]}function Vi(e,t,n,r){return[e(n,r),Fi(t,n).id,e(n,r),e("time",r)]}function Qi(e,t,n){return e.map(r=>r===t?n:r)}function zn(e,t,n,r,i){const s=ce(t,n,i),o=Nn(t,n,i),a=s||o;if(!a)throw new de(`Could not find attr for ${[n,i]}`);if(a["value-type"]!=="ref")throw new Error(`Attr ${a.id} is not a ref`);const[c,u]=a["forward-identity"],[d,l]=a["reverse-identity"],f=r+1,h=s?[e(u,r),a.id,e(l,f),be("time")]:[e(u,f),a.id,e(l,r),be("time")];return[s?l:u,f,h,a,!!s]}function qt(e,t){if(typeof t!="string")return function(o){return!1};const r=t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/%/g,".*").replace(/_/g,"."),i=new RegExp(`^${r}$`,e?void 0:"i");return function(o){return typeof o!="string"?!1:i.test(o)}}function Wi(e,t){if(typeof t!="object"||t.hasOwnProperty("$in")||t.hasOwnProperty("in"))return t;const n=e["checked-data-type"]==="date";if(t.hasOwnProperty("$gt"))return{$comparator:!0,$op:n?function(i){return new Date(i[2])>new Date(t.$gt)}:function(i){return i[2]>t.$gt}};if(t.hasOwnProperty("$gte"))return{$comparator:!0,$op:n?function(i){return new Date(i[2])>=new Date(t.$gte)}:function(i){return i[2]>=t.$gte}};if(t.hasOwnProperty("$lt"))return{$comparator:!0,$op:n?function(i){return new Date(i[2])<new Date(t.$lt)}:function(i){return i[2]<t.$lt}};if(t.hasOwnProperty("$lte"))return{$comparator:!0,$op:n?function(i){return new Date(i[2])<=new Date(t.$lte)}:function(i){return i[2]<=t.$lte}};if(t.hasOwnProperty("$like")){const r=qt(!0,t.$like);return{$comparator:!0,$op:function(s){return r(s[2])}}}if(t.hasOwnProperty("$ilike")){const r=qt(!1,t.$ilike);return{$comparator:!0,$op:function(s){return r(s[2])}}}return t}function Bi(e,t,n,r,i,s){const o=ce(t,n,i),a=Nn(t,n,i),c=o||a;if(!c)throw new de(`No attr for etype = ${n} label = ${i}`);if(s!=null&&s.hasOwnProperty("$isNull")){const u=ce(t,n,"id");if(!u)throw new de(`No attr for etype = ${n} label = id`);return[e(n,r),u.id,{$isNull:{attrId:c.id,isNull:s.$isNull,reverse:!o}},be("time")]}return o?[e(n,r),c.id,Wi(c,s),be("time")]:[s,c.id,e(n,r),be("time")]}function Ji(e,t,n,r,i){const[s,o,a]=i.reduce((c,u)=>{const[d,l,f]=c,[h,p,y]=zn(e,t,d,l,u);return[h,p,[...f,y]]},[n,r,[]]);return[s,o,a]}function et(e,t,n,r,i,s){const o=i.slice(0,i.length-1),a=i[i.length-1],[c,u,d]=Ji(e,t,n,r,o),l=Bi(e,t,c,u,a,s);return d.concat([l])}function Hi(e,t){return t?[t].concat(e):e}function Ki([e,t]){return e==="or"&&Array.isArray(t)}function Zi([e,t]){return e==="and"&&Array.isArray(t)}function Gi(e,t,n){return(r,i)=>{const s=e(r,i);return t==s?s:`${s}-${n}`}}function zt(e,t,n,r,i,s){const o=e(r,i),a=s.map((c,u)=>{const d=Gi(e,o,u);return Fn(d,n,r,i,c)});return{[t]:{patterns:a,joinSym:o}}}function Yi(e){const t=[];for(let n=1;n<=e.length;n++)t.push(e.slice(0,n));return t}function Ft(e,t,n,r,i){return Yi(i).map(s=>et(e,t,n,r,s,{$isNull:!0}))}function Fn(e,t,n,r,i){return Object.entries(i).flatMap(([s,o])=>{if(Ki([s,o]))return zt(e,"or",t,n,r,o);if(Zi([s,o]))return zt(e,"and",t,n,r,o);if(s==="$entityIdStartsWith")return[];const a=s.split(".");if(o!=null&&o.hasOwnProperty("$not")){const c=et(e,t,n,r,a,o),u=Ft(e,t,n,r,a);return[{or:{patterns:[c,...u],joinSym:e(n,r)}}]}return o!=null&&o.hasOwnProperty("$isNull")&&o.$isNull===!0&&a.length>1?[{or:{patterns:Ft(e,t,n,r,a),joinSym:e(n,r)}}]:et(e,t,n,r,a,o)})}function Xi(e,t,n,r){const i=Re;return r?Fn(i,e,t,n,r).concat(Nt(i,e,t,n)):Nt(i,e,t,n)}function es(e,t,n){return[e(t,n),e("time",n)]}function ts(e,t,n,r,i,s){const[o,a,c,u,d]=zn(e,t,n,r,i),l=Qi(c,e(n,r),s);return[o,a,l,u,d]}function ns(e,t,{etype:n,level:r,form:i},s){const o=Object.keys(i).filter(a=>a!=="$");return o.length?Object.entries(s).map(function([c,u]){return o.map(function(f){var h,p,y;const v=!!(t.cardinalityInference&&(!((y=(p=(h=t.linkIndex)===null||h===void 0?void 0:h[n])===null||p===void 0?void 0:p[f])===null||y===void 0)&&y.isSingular));try{const[b,_,m]=ts(e,t,n,r,f,c),P=Vn(t,{etype:b,level:_,form:i[f],join:m}),w=v?P[0]:P;return{[f]:w}}catch(b){if(b instanceof de)return{[f]:v?void 0:[]};throw b}}).reduce(function(f,h){return Object.assign(Object.assign({},f),h)},u)}):Object.values(s)}function Pe([e,t],[n,r]){return t===r||t==null&&r==null?qi(e,n):r==null?1:t==null?-1:t>r?1:-1}function tt(e){return e==null?e:new Date(e).getTime()}function rs(e,t,n,r){var i;const[s,o,a,c]=e,u=n==="desc"?1:-1;if(((i=t["forward-identity"])===null||i===void 0?void 0:i[2])==="id")return Pe(r,[s,c])===u;const[d,l]=r,f=t["checked-data-type"]==="date"?tt(l):l,h=t["checked-data-type"]==="date"?tt(a):a;return Pe([d,f],[s,h])===u}function is(e,t){const n=t[1];return e.attrs[n]}function ss(e,t,n){const r=Object.keys(n)[0];return ce(e,t,r)}function os(e,t,n,r){if(n)return is(e,n);if(r)return ss(e,t,r)}function as(e,t,n){var r,i;if(!Array.isArray(n.fields))return gi(e,t);const s=new Map;for(const o of n.fields){const a=ce(e,t,o),c=(r=a==null?void 0:a["forward-identity"])===null||r===void 0?void 0:r[2];c&&gt(a)&&s.set(c,a)}if(!s.has("id")){const o=ce(e,t,"id"),a=(i=o==null?void 0:o["forward-identity"])===null||i===void 0?void 0:i[2];a&&s.set(a,o)}return s}function cs(e,t,n,r,i,s){var o;let a=Ei(e,s);const c=r==null?void 0:r["start-cursor"],u=os(e,t,c,i);if(u&&((o=u==null?void 0:u["forward-identity"])===null||o===void 0?void 0:o[2])!=="id"){const f=u["checked-data-type"]==="date",h=u.id;a=a.map(([p])=>{var y,v,b,_,m;let P=(m=(_=(b=(v=(y=e.eav.get(p))===null||y===void 0?void 0:y.get(h))===null||v===void 0?void 0:v.values())===null||b===void 0?void 0:b.next())===null||_===void 0?void 0:_.value)===null||m===void 0?void 0:m[2];return f&&(P=tt(P)),[p,P]})}a.sort(n==="asc"?function(h,p){return Pe(h,p)}:function(h,p){return Pe(p,h)});let d={};const l=as(e,t,s);for(const f of a){const[h]=f;if(d[h]||c&&u&&rs(c,u,n,f))continue;const p=_i(e,l,h);p&&(d[h]=p)}return d}function us(e){var t;const n=(t=e.$)===null||t===void 0?void 0:t.order;return n&&n[Object.keys(n)[0]]||"asc"}function ds(e,{etype:t,level:n,form:r,join:i,pageInfo:s}){var o,a,c,u,d,l,f,h,p;const y=((o=r.$)===null||o===void 0?void 0:o.limit)||((a=r.$)===null||a===void 0?void 0:a.first)||((c=r.$)===null||c===void 0?void 0:c.last),v=(u=r.$)===null||u===void 0?void 0:u.offset,b=(d=r.$)===null||d===void 0?void 0:d.before,_=(l=r.$)===null||l===void 0?void 0:l.after,m=(f=r.$)===null||f===void 0?void 0:f.order,P=(h=r.$)===null||h===void 0?void 0:h.fields;if((v||b||_)&&(!s||!s["start-cursor"]))return[];const w=Hi(Xi(e,t,n,(p=r.$)===null||p===void 0?void 0:p.where),i),C=es(Re,t,n),$=cs(e,t,us(r),s,m,{where:w,find:C,fields:P});if(y!=null){const Q=Object.entries($);return Q.length<=y?$:Object.fromEntries(Q.slice(0,y))}return $}function ls(e,t){try{return ds(e,t)}catch(n){if(n instanceof de)return{};throw n}}function Vn(e,t){const n=ls(e,t);return ns(Re,e,t,n)}function fs(e){const t={};for(const[n,r]of Object.entries(e))t[n]={startCursor:r["start-cursor"],endCursor:r["end-cursor"],hasNextPage:r["has-next-page?"],hasPreviousPage:r["has-previous-page?"]};return t}function hs({store:e,pageInfo:t,aggregate:n},r){const s={data:Object.keys(r).reduce(function(a,c){return n!=null&&n[c]||c==="$$ruleParams"||(a[c]=Vn(e,{etype:c,form:r[c],level:0,pageInfo:t==null?void 0:t[c]})),a},{})};return t&&(s.pageInfo=fs(t)),n&&(s.aggregate=n),s}function ps(){const t={__etype:1,__ops:1,create:1,update:1,link:1,unlink:1,delete:1,merge:1,ruleParams:1};return new Set(Object.keys(t))}const ys=ps();function nt(e,t,n){const r={__etype:e,__ops:n};return new Proxy(r,{get:(i,s)=>{if(s==="__ops")return n;if(s==="__etype")return e;if(ys.has(s))return(o,a)=>nt(e,t,[...n,a?[s,e,t,o,a]:[s,e,t,o]])}})}function rt(e){return e.startsWith("lookup__")}function Qn(e){const[t,n,...r]=e.split("__");return[n,JSON.parse(r.join("__"))]}function bs(e){return new Proxy({__etype:e},{get(t,n){if(n==="__etype")return e;const r=n;return rt(r)?nt(e,Qn(r),[]):nt(e,r,[])}})}function Ot(){return new Proxy({},{get(e,t){return bs(t)}})}const aa=Ot();function vs(e){return e.__ops}function _s(e,t){const{attrIdMap:n,refSwapAttrIds:r}=e,i=[];for(const o of t){const a=n[o];if(a)i.push(a);else if(Array.isArray(o)&&o.length==2&&n[o[0]]){const[c,u]=o;i.push([n[c],u])}else i.push(o)}const[s]=t;if((s==="add-triple"||s==="retract-triple")&&r.has(t[2])){const o=i[1];i[1]=i[3],i[3]=o}return i}function T(e,t,n){return Object.values(e).find(r=>{const[i,s,o]=r["forward-identity"];return s===t&&o===n})}function te(e,t,n){return Object.values(e).find(r=>{const i=r["reverse-identity"];if(!i)return!1;const[s,o,a]=i;return o===t&&a===n})}function gs(e){if(Array.isArray(e))return e;const t=Object.entries(e);if(t.length!==1)throw new Error("lookup must be an object with a single unique attr and value.");return t[0]}function it(e,t,n){return n.indexOf(".")!==-1&&!T(e,t,n)}function st(e){const[t,n,...r]=e.split(".");if(r.length>0||n!=="id")throw new Error(`${e} is not a valid lookup attribute.`);return t}function ws(e,t,n){if(!it(e,t,n))return T(e,t,n);const r=st(n),i=T(e,t,r)||te(e,t,r);if(i&&i["value-type"]!=="ref")throw new Error(`${n} does not reference a valid link attribute.`);return i}function ot(e){return typeof e=="string"&&!rt(e)?null:typeof e=="string"&&rt(e)?Qn(e):gs(e)}function L(e,t,n){const r=ot(n);if(r===null)return n;const[i,s]=r,o=ws(e,t,i);if(!o||!o["unique?"])throw new Error(`${i} is not a unique attribute.`);return[o.id,s]}function Wn(e,t,n,r){const i=L(e,t,n);return Array.isArray(i)?[["add-triple",i,T(e,t,"id").id,i]].concat(r):r}function ms({attrs:e},[t,n,r]){const i=Object.entries(r).flatMap(([s,o])=>{const a=Array.isArray(o)?o:[o],c=T(e,t,s),u=te(e,t,s);return a.map(d=>c?["add-triple",L(e,t,n),c.id,L(e,c["reverse-identity"][1],d)]:["add-triple",L(e,u["forward-identity"][1],d),u.id,L(e,t,n)])});return Wn(e,t,n,i)}function Os({attrs:e},[t,n,r]){const i=Object.entries(r).flatMap(([s,o])=>{const a=Array.isArray(o)?o:[o],c=T(e,t,s),u=te(e,t,s);return a.map(d=>c?["retract-triple",L(e,t,n),c.id,L(e,c["reverse-identity"][1],d)]:["retract-triple",L(e,u["forward-identity"][1],d),u.id,L(e,t,n)])});return Wn(e,t,n,i)}function ks(e,t,n){if(Array.isArray(n)){const[r,i]=n;for(const s of e||[]){const o=s==null?void 0:s.aev.get(r);if(o){for(const[a,c,u]of U(o,2))if(u===i)return!0}}}else for(const r of e||[]){const i=r==null?void 0:r.eav.get(n);if(i){for(const s of i.keys())if(r.attrs[s]["forward-identity"][1]==t)return!0}}return!1}function Bn({stores:e,attrs:t},[n,r,i,s]){return(s==null?void 0:s.upsert)===!1?{mode:"update"}:(s==null?void 0:s.upsert)===!0?null:ks(e,n,r)?{mode:"update"}:null}function Ss(e,t){const{stores:n,attrs:r}=e,[i,s,o,a]=t,c=vt(o),u=L(r,i,s);return[["id",u]].concat(Object.entries(c)).map(([l,f])=>{const h=T(r,i,l);return h["checked-data-type"]==="date"&&e.useDateObjects&&(f=xe(f)),["add-triple",u,h.id,f,{mode:"create"}]})}function js(e,t){const{stores:n,attrs:r}=e,[i,s,o,a]=t,c=vt(o),u=L(r,i,s),d=Bn(e,[i,u,o,a]);return[["id",u]].concat(Object.entries(c)).map(([f,h])=>{const p=T(r,i,f);return p["checked-data-type"]==="date"&&e.useDateObjects&&(h=xe(h)),["add-triple",u,p.id,h,...d?[d]:[]]})}function Ms({attrs:e},[t,n]){return[["delete-entity",L(e,t,n),t]]}function $s(e,t){const{stores:n,attrs:r}=e,[i,s,o,a]=t,c=vt(o),u=L(r,i,s),d=Bn(e,[i,u,o,a]),l=Object.entries(c).map(([h,p])=>{const y=T(r,i,h);return["deep-merge-triple",u,y.id,p,...d?[d]:[]]});return[["add-triple",u,T(r,i,"id").id,u,...d?[d]:[]]].concat(l)}function As({attrs:e},[t,n,r]){return[["rule-params",L(e,t,n),t,r]]}function Is(e){const[t,n,r,i,s]=e;if(!i)return e;const o=Object.assign({},i);return delete o.id,[t,n,r,o,...s?[s]:[]]}function Ts(e,t){const[n,...r]=Is(t);switch(n){case"merge":return $s(e,r);case"create":return Ss(e,r);case"update":return js(e,r);case"link":return ms(e,r);case"unlink":return Os(e,r);case"delete":return Ms(e,r);case"ruleParams":return As(e,r);default:throw new Error(`unsupported action ${n}`)}}function Es(e){switch(e){case"string":case"date":case"boolean":case"number":return e;default:return}}function Ps(e,t,n){var r,i;const s=(i=(r=e.entities[t])===null||r===void 0?void 0:r.attrs)===null||i===void 0?void 0:i[n];if(n==="id")return null;if(!s)throw new Error(`${t}.${n} does not exist in your schema`);const{unique:o,indexed:a}=s==null?void 0:s.config,c=Es(s==null?void 0:s.valueType);return{"index?":a,"unique?":o,"checked-data-type":c}}function Ne(e,t,n,r){const i=e?Ps(e,t,n):null,s=I(),a=[I(),t,n];return Object.assign(Object.assign({id:s,"forward-identity":a,"value-type":"blob",cardinality:"one","unique?":!1,"index?":!1,isUnsynced:!0},i||{}),r||{})}function xs(e,t,n){return Object.values(e.links).find(i=>i.forward.on===t&&i.forward.label===n||i.reverse.on===t&&i.reverse.label===n)}function Cs(e,t,n){const r=xs(e,t,n);if(!r)throw new Error(`Couldn't find the link ${t}.${n} in your schema`);const{forward:i,reverse:s}=r;return{"forward-identity":[I(),i.on,i.label],"reverse-identity":[I(),s.on,s.label],cardinality:i.has==="one"?"one":"many","unique?":s.has==="one","on-delete":i.onDelete,"on-delete-reverse":s.onDelete}}function Vt(e,t,n,r){const i=e?Cs(e,t,n):null,s=I(),o=[I(),t,n],a=[I(),n,t];return Object.assign(Object.assign({id:s,"forward-identity":o,"reverse-identity":a,"value-type":"ref",cardinality:"many","unique?":!1,"index?":!1,isUnsynced:!0},i||{}),r||{})}const Rs=new Set(["create","update","merge","link","unlink"]),Ds=new Set(["link","unlink"]),Us=new Set(["create","update","merge"]),Ls=new Set(["link","unlink","create","update","merge","delete","ruleParams"]),at={"unique?":!0,"index?":!0},Ns=Object.assign(Object.assign({},at),{cardinality:"one"});function qs(e){const t=[],[n,r,i,s]=e;if(!Ls.has(n))return t;const o=ot(i);if(o&&t.push({etype:r,lookupPair:o}),n==="link")for(const[a,c]of Object.entries(s)){const u=Array.isArray(c)?c:[c];for(const d of u){const l=ot(d);l&&t.push({etype:r,lookupPair:l,linkLabel:a})}}return t}function zs({attrs:e,schema:t},n){var r,i;const[s,o,a]=[new Set,Object.assign({},e),[]];function c(l){o[l.id]=l,a.push(["add-attr",l]),s.add(l.id)}function u(l){l!=null&&l.isUnsynced&&!s.has(l.id)&&(a.push(["add-attr",l]),s.add(l.id))}function d(l,f){const h=T(o,l,f),p=te(o,l,f);u(h),u(p),!h&&!p&&c(Vt(t,l,f,Ns))}for(const l of n)for(const{etype:f,lookupPair:h,linkLabel:p}of qs(l)){const y=h[0];if(p){d(f,p);const v=T(o,f,p),b=te(o,f,p);u(v),u(b);const _=((r=v==null?void 0:v["reverse-identity"])===null||r===void 0?void 0:r[1])||((i=b==null?void 0:b["forward-identity"])===null||i===void 0?void 0:i[1])||p;if(it(o,_,y))d(_,st(y));else{const m=T(o,_,y);m||c(Ne(t,_,y,at)),u(m)}}else if(it(o,f,y))d(f,st(y));else{const v=T(o,f,y);v||c(Ne(t,f,y,at)),u(v)}}for(const l of n){const[f,h,p,y]=l;if(Rs.has(f)){const v=Object.keys(y);v.push("id");for(const b of v){const _=T(o,h,b);if(u(_),Us.has(f)&&(_||c(Ne(t,h,b,b==="id"?{"unique?":!0}:null))),Ds.has(f)){const m=te(o,h,b);!_&&!m&&c(Vt(t,h,b)),u(m)}}}}return[o,a]}function Fs(e,t){const r=(Array.isArray(t)?t:[t]).flatMap(c=>vs(c)),[i,s]=zs(e,r),o=Object.assign(Object.assign({},e),{attrs:i}),a=r.flatMap(c=>Ts(o,c));return[...s,...a]}var Qt=function(e,t,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(d){try{u(r.next(d))}catch(l){o(l)}}function c(d){try{u(r.throw(d))}catch(l){o(l)}}function u(d){d.done?s(d.value):i(d.value).then(a,c)}u((r=r.apply(e,t||[])).next())})};class Jn{constructor(t){this.dbName=t,this._storeName="kv",this._dbPromise=this._init()}_init(){return new Promise((t,n)=>{const r=indexedDB.open(this.dbName,1);r.onerror=i=>{n(i)},r.onsuccess=i=>{t(i.target.result)},r.onupgradeneeded=i=>{i.target.result.createObjectStore(this._storeName)}})}getItem(t){return Qt(this,void 0,void 0,function*(){const n=yield this._dbPromise;return new Promise((r,i)=>{const a=n.transaction([this._storeName],"readonly").objectStore(this._storeName).get(t);a.onerror=c=>{i(c)},a.onsuccess=c=>{a.result?r(a.result):r(null)}})})}setItem(t,n){return Qt(this,void 0,void 0,function*(){const r=yield this._dbPromise;return new Promise((i,s)=>{const c=r.transaction([this._storeName],"readwrite").objectStore(this._storeName).put(n,t);c.onerror=u=>{s(u)},c.onsuccess=u=>{i()}})})}}var Vs=function(e,t,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(d){try{u(r.next(d))}catch(l){o(l)}}function c(d){try{u(r.throw(d))}catch(l){o(l)}}function u(d){d.done?s(d.value):i(d.value).then(a,c)}u((r=r.apply(e,t||[])).next())})};class Hn{static getIsOnline(){return Vs(this,void 0,void 0,function*(){return navigator.onLine})}static listen(t){const n=()=>{t(!0)},r=()=>{t(!1)};return addEventListener("online",n),addEventListener("offline",r),()=>{removeEventListener("online",n),removeEventListener("offline",r)}}}class _e extends Error{constructor(t,n){super(t),this.hint=n;const r=new.target.prototype;Object.setPrototypeOf&&Object.setPrototypeOf(this,r),Error.captureStackTrace&&Error.captureStackTrace(this,_e),this.name="InstantError"}get[Symbol.toStringTag](){return"InstantError"}}var Qs=function(e,t,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(d){try{u(r.next(d))}catch(l){o(l)}}function c(d){try{u(r.throw(d))}catch(l){o(l)}}function u(d){d.done?s(d.value):i(d.value).then(a,c)}u((r=r.apply(e,t||[])).next())})};class De extends _e{constructor(t){var n;const r=((n=t.body)===null||n===void 0?void 0:n.message)||`API Error (${t.status})`;super(r,t.body.hint);const i=new.target.prototype;Object.setPrototypeOf&&Object.setPrototypeOf(this,i),Error.captureStackTrace&&Error.captureStackTrace(this,De),this.name="InstantAPIError",this.status=t.status,this.body=t.body}get[Symbol.toStringTag](){return"InstantAPIError"}}function J(e,t){return Qs(this,void 0,void 0,function*(){const n=yield fetch(e,t),r=yield n.json();return n.status===200?Promise.resolve(r):Promise.reject(new De({status:n.status,body:r}))})}var Oe=function(e,t,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(d){try{u(r.next(d))}catch(l){o(l)}}function c(d){try{u(r.throw(d))}catch(l){o(l)}}function u(d){d.done?s(d.value):i(d.value).then(a,c)}u((r=r.apply(e,t||[])).next())})};function Ws({apiURI:e,appId:t,email:n}){return J(`${e}/runtime/auth/send_magic_code`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({"app-id":t,email:n})})}function Bs(e){return Oe(this,arguments,void 0,function*({apiURI:t,appId:n,email:r,code:i}){return yield J(`${t}/runtime/auth/verify_magic_code`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({"app-id":n,email:r,code:i})})})}function Js(e){return Oe(this,arguments,void 0,function*({apiURI:t,appId:n,refreshToken:r}){return yield J(`${t}/runtime/auth/verify_refresh_token`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({"app-id":n,"refresh-token":r})})})}function Wt(e){return Oe(this,arguments,void 0,function*({apiURI:t,appId:n,code:r,codeVerifier:i}){return yield J(`${t}/runtime/oauth/token`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({app_id:n,code:r,code_verifier:i})})})}function Hs(e){return Oe(this,arguments,void 0,function*({apiURI:t,appId:n,nonce:r,idToken:i,clientName:s,refreshToken:o}){return yield J(`${t}/runtime/oauth/id_token`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({app_id:n,nonce:r,id_token:i,client_name:s,refresh_token:o})})})}function Ks(e){return Oe(this,arguments,void 0,function*({apiURI:t,appId:n,refreshToken:r}){return yield J(`${t}/runtime/signout`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({app_id:n,refresh_token:r})})})}var ke=function(e,t,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(d){try{u(r.next(d))}catch(l){o(l)}}function c(d){try{u(r.throw(d))}catch(l){o(l)}}function u(d){d.done?s(d.value):i(d.value).then(a,c)}u((r=r.apply(e,t||[])).next())})};function Zs(e){return ke(this,arguments,void 0,function*({apiURI:t,appId:n,path:r,file:i,refreshToken:s,contentType:o,contentDisposition:a}){const c={app_id:n,path:r,authorization:`Bearer ${s}`,"content-type":o||i.type};return a&&(c["content-disposition"]=a),yield J(`${t}/storage/upload`,{method:"PUT",headers:c,body:i})})}function Gs(e){return ke(this,arguments,void 0,function*({apiURI:t,appId:n,path:r,refreshToken:i}){const{data:s}=yield J(`${t}/storage/files?app_id=${n}&filename=${encodeURIComponent(r)}`,{method:"DELETE",headers:{"content-type":"application/json",authorization:`Bearer ${i}`}});return s})}function Ys(e){return ke(this,arguments,void 0,function*({apiURI:t,appId:n,fileName:r,refreshToken:i,metadata:s={}}){const{data:o}=yield J(`${t}/storage/signed-upload-url`,{method:"POST",headers:{"content-type":"application/json",authorization:`Bearer ${i}`},body:JSON.stringify({app_id:n,filename:r})});return o})}function Xs(e,t){return ke(this,void 0,void 0,function*(){return(yield fetch(e,{method:"PUT",body:t,headers:{"Content-Type":t.type}})).ok})}function eo(e){return ke(this,arguments,void 0,function*({apiURI:t,appId:n,path:r,refreshToken:i}){const{data:s}=yield J(`${t}/storage/signed-download-url?app_id=${n}&filename=${encodeURIComponent(r)}`,{method:"GET",headers:{"content-type":"application/json",authorization:`Bearer ${i}`}});return s})}let kt=!1,Kn=!1,Zn=!1;typeof window<"u"&&typeof window.localStorage<"u"&&(kt=!!window.localStorage.getItem("devBackend"),Kn=!!window.localStorage.getItem("__instantLogging"),Zn=!!window.localStorage.getItem("__devtoolLocalDash"));function Bt(e,t){if(!t)return e;const n={};return t.forEach(r=>{n[r]=e[r]}),n}function to(e,t,n){var r,i;const s={peers:{}};if(t&&"user"in t?t.user:!0){const a=Bt((r=e.user)!==null&&r!==void 0?r:{},t==null?void 0:t.keys);s.user=Object.assign(Object.assign({},a),{peerId:n})}for(const a of Object.keys((i=e.peers)!==null&&i!==void 0?i:{})){const c=(t==null?void 0:t.peers)===void 0,u=Array.isArray(t==null?void 0:t.peers)&&(t==null?void 0:t.peers.includes(a));if(c||u){const d=Bt(e.peers[a],t==null?void 0:t.keys);s.peers[a]=Object.assign(Object.assign({},d),{peerId:a})}}return s}function no(e,t){if(e.isLoading!==t.isLoading||e.error!==t.error||(e.user||t.user)&&(!e.user||!t.user||!Ct(e.user,t.user))||!Tn(e.peers,t.peers))return!0;for(const r of Object.keys(e.peers))if(!Ct(e.peers[r],t.peers[r]))return!0;return!1}class Jt{constructor(){this.promise=new Promise((t,n)=>{this._resolve=t,this._reject=n})}resolve(t){this._resolve(t)}reject(t){this._reject(t)}}var je=function(e,t,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(d){try{u(r.next(d))}catch(l){o(l)}}function c(d){try{u(r.throw(d))}catch(l){o(l)}}function u(d){d.done?s(d.value):i(d.value).then(a,c)}u((r=r.apply(e,t||[])).next())})};class Ht{constructor(t,n,r,i,s=c=>JSON.stringify(c),o=c=>JSON.parse(c),a=100){this._subs=[],this._persister=t,this._key=n,this._onMerge=i,this._loadedCbs=[],this._isLoading=!0,this.currentValue=r,this.toJSON=s,this.fromJSON=o,this._saveThrottleMs=a,this._pendingSaveCbs=[],this._version=0,this._load()}_load(){return je(this,void 0,void 0,function*(){const t=this.fromJSON(yield this._persister.getItem(this._key));this._isLoading=!1,this._onMerge(t,this.currentValue);for(const n of this._loadedCbs)n()})}waitForLoaded(){return je(this,void 0,void 0,function*(){if(!this._isLoading)return;yield new Promise(n=>{this._loadedCbs.push(n)})})}isLoading(){return this._isLoading}version(){return this._version}waitForSync(){return je(this,void 0,void 0,function*(){if(!this._nextSave)return;yield new Promise(n=>{this._pendingSaveCbs.push(n)})})}_writeToStorage(){this._persister.setItem(this._key,this.toJSON(this.currentValue));for(const t of this._pendingSaveCbs)t();this._pendingSaveCbs.length=0}flush(){return je(this,void 0,void 0,function*(){this._nextSave&&(clearTimeout(this._nextSave),this._writeToStorage())})}_enqueuePersist(t){if(this._nextSave){t&&this._pendingSaveCbs.push(t);return}this._nextSave=setTimeout(()=>{this._nextSave=null,this._writeToStorage()},this._saveThrottleMs)}set(t,n){this._version++,this.currentValue=t(this.currentValue),this._isLoading?this._loadedCbs.push(()=>this._enqueuePersist(n)):this._enqueuePersist(n);for(const r of this._subs)r(this.currentValue)}subscribe(t){return this._subs.push(t),t(this.currentValue),()=>{this._subs=this._subs.filter(n=>n!==t)}}}function Gn(e,t=[]){e.forEach(n=>{const{data:r}=n,{"datalog-result":i}=r,{"join-rows":s}=i;for(const o of s)for(const a of o)t.push(a);Gn(n["child-nodes"],t)})}function Kt(e){const t=[];return Gn(e,t),t}function Zt(e){return Object.values(e.links).reduce((t,n)=>{var r,i,s,o;return(r=t[s=n.forward.on])!==null&&r!==void 0||(t[s]={}),t[n.forward.on][n.forward.label]={isForward:!0,isSingular:n.forward.has==="one",link:n},(i=t[o=n.reverse.on])!==null&&i!==void 0||(t[o]={}),t[n.reverse.on][n.reverse.label]={isForward:!1,isSingular:n.reverse.has==="one",link:n},t},{})}const St="v0.20.20";function ro(e){return{info:e?console.info.bind(console):()=>{},debug:e?console.debug.bind(console):()=>{},error:e?console.error.bind(console):()=>{}}}class K{constructor(t,n,r,i={indexed:!1,unique:!1}){this.valueType=t,this.required=n,this.isIndexed=r,this.config=i,this.metadata={}}clientRequired(){return new K(this.valueType,!1,this.isIndexed,this.config)}optional(){return new K(this.valueType,!1,this.isIndexed,this.config)}unique(){return new K(this.valueType,this.required,this.isIndexed,Object.assign(Object.assign({},this.config),{unique:!0}))}indexed(){return new K(this.valueType,this.required,!0,Object.assign(Object.assign({},this.config),{indexed:!0}))}}class k extends Error{constructor(t,n){const r=n?`At path '${n}': ${t}`:t;super(r),this.name="QueryValidationError"}}const Gt=["where","order","limit","last","first","offset","after","before","fields","aggregate"],io=e=>e.valueType||"unknown",Yn=(e,t,n=!1)=>{if(n||e==null)return!0;switch(t){case"string":return typeof e=="string";case"number":return typeof e=="number"&&!isNaN(e);case"boolean":return typeof e=="boolean";case"date":return e instanceof Date||typeof e=="string";default:return!0}},so=(e,t,n,r,i,s,o)=>{const a=s.valueType==="json",c=(u,d,l)=>{if(!Yn(l,d,a))throw new k(`Invalid value for operator '${u}' on attribute '${r}' in entity '${i}'. Expected ${d}, but received: ${typeof l}`,o)};switch(e){case"in":case"$in":if(!Array.isArray(t))throw new k(`Operator '${e}' for attribute '${r}' in entity '${i}' must be an array, but received: ${typeof t}`,o);for(const u of t)c(e,n,u);break;case"$not":case"$gt":case"$lt":case"$gte":case"$lte":c(e,n,t);break;case"$like":case"$ilike":if(c(e,"string",t),e==="$ilike"&&!s.isIndexed)throw new k(`Operator '${e}' can only be used with indexed attributes, but '${r}' in entity '${i}' is not indexed`,o);break;case"$isNull":if(c(e,"boolean",t),s.required&&t===!0)throw new k(`Cannot use '$isNull: true' on required attribute '${r}' in entity '${i}'`,o);break;default:throw new k(`Unknown operator '${e}' for attribute '${r}' in entity '${i}'`,o)}},ae=(e,t,n,r,i)=>{const s=io(n),o=n.valueType==="json";if(typeof e=="object"&&e!==null&&!Array.isArray(e)){if(o)return;const c=e;for(const[u,d]of Object.entries(c))so(u,d,s,t,r,n,`${i}.${u}`)}else if(!Yn(e,s,o))throw new k(`Invalid value for attribute '${t}' in entity '${r}'. Expected ${s}, but received: ${typeof e}`,i)},oo=(e,t,n,r,i)=>{const s=e.split(".");if(s.length<2)throw new k(`Invalid dot notation path '${e}'. Must contain at least one dot.`,i);let o=n;for(let d=0;d<s.length-1;d++){const l=s[d],f=r.entities[o];if(!f)throw new k(`Entity '${o}' does not exist in schema while traversing dot notation path '${e}'.`,i);const h=f.links[l];if(!h){const p=Object.keys(f.links);throw new k(`Link '${l}' does not exist on entity '${o}' in dot notation path '${e}'. Available links: ${p.length>0?p.join(", "):"none"}`,i)}o=h.entityName}const a=s[s.length-1],c=r.entities[o];if(!c)throw new k(`Target entity '${o}' does not exist in schema for dot notation path '${e}'.`,i);if(a==="id"){if(!ue(t))throw new k(`Invalid value for id field in entity '${o}'. Expected a UUID, but received: ${t}`,i);ae(t,e,new K("string",!1,!0),n,i);return}const u=c.attrs[a];if(Object.keys(c.links).includes(a)){if(!ue(t))throw new k(`Invalid value for link '${a}' in entity '${o}'. Expected a UUID, but received: ${t}`,i);ae(t,e,new K("string",!1,!0),n,i);return}if(!u){const d=Object.keys(c.attrs);throw new k(`Attribute '${a}' does not exist on entity '${o}' in dot notation path '${e}'. Available attributes: ${d.length>0?d.join(", ")+", id":"id"}`,i)}ae(t,e,u,n,i)},Xn=(e,t,n,r)=>{for(const[i,s]of Object.entries(e)){if(i==="or"||i==="and"){if(Array.isArray(s))for(const u of s)typeof u=="object"&&u!==null&&Xn(u,t,n,`${r}.${i}[${u}]`);continue}if(i==="id"){ae(s,"id",new K("string",!1,!0),t,`${r}.id`);continue}if(i.includes(".")){oo(i,s,t,n,`${r}.${i}`);continue}const o=n.entities[t];if(!o)continue;const a=o.attrs[i],c=o.links[i];if(!a&&!c){const u=Object.keys(o.attrs),d=Object.keys(o.links);throw new k(`Attribute or link '${i}' does not exist on entity '${t}'. Available attributes: ${u.length>0?u.join(", "):"none"}. Available links: ${d.length>0?d.join(", "):"none"}`,`${r}.${i}`)}if(a)ae(s,i,a,t,`${r}.${i}`);else if(c){if(!ue(s))throw new k(`Invalid value for link '${i}' in entity '${t}'. Expected a UUID, but received: ${s}`,`${r}.${i}`);const u=new K("string",!1,!0);ae(s,i,u,t,`${r}.${i}`)}}},ao=(e,t,n,r,i=0)=>{for(const o of Object.keys(e))if(!Gt.includes(o))throw new k(`Invalid query parameter '${o}' in $ object. Valid parameters are: ${Gt.join(", ")}. Found: ${o}`,r);const s=["limit","offset","before","after","first","last"];for(const o of s)if(e[o]!==void 0&&i>0)throw new k(`'${o}' can only be used on top-level namespaces. It cannot be used in nested queries.`,r);if(e.where&&n){if(typeof e.where!="object"||e.where===null)throw new k(`'where' clause must be an object in entity '${t}', but received: ${typeof e.where}`,r?`${r}.where`:void 0);Xn(e.where,t,n,r?`${r}.where`:"where")}},er=(e,t,n,r,i=0)=>{var s;if(!e||typeof e!="object")throw new k(`Query part for entity '${t}' must be an object, but received: ${typeof e}`,r);for(const o of Object.keys(e))if(o!=="$"){if(n&&!(o in n.entities[t].links)){const c=Object.keys(n.entities[t].links);throw new k(`Link '${o}' does not exist on entity '${t}'. Available links: ${c.length>0?c.join(", "):"none"}`,`${r}.${o}`)}const a=e[o];if(typeof a=="object"&&a!==null){const c=(s=n==null?void 0:n.entities[t].links[o])===null||s===void 0?void 0:s.entityName;c&&er(a,c,n,`${r}.${o}`,i+1)}}else{const a=e[o];if(typeof a!="object"||a===null)throw new k(`Query parameter '$' must be an object in entity '${t}', but received: ${typeof a}`,`${r}.$`);ao(a,t,n,`${r}.$`,i)}},Yt=(e,t)=>{if(typeof e!="object"||e===null)throw new k(`Query must be an object, but received: ${typeof e}${e===null?" (null)":""}`);if(Array.isArray(e))throw new k(`Query must be an object, but received: ${typeof e}`);const n=e;for(const r of Object.keys(n)){if(Array.isArray(e[r]))throw new k(`Query keys must be strings, but found key of type: ${typeof r}`,r);if(typeof r!="string")throw new k(`Query keys must be strings, but found key of type: ${typeof r}`,r);if(r!=="$$ruleParams"){if(t&&!t.entities[r]){const i=Object.keys(t.entities);throw new k(`Entity '${r}' does not exist in schema. Available entities: ${i.length>0?i.join(", "):"none"}`,r)}er(n[r],r,t,r,0)}}};class z extends Error{constructor(t){super(t),this.name="TransactionValidationError"}}const tr=e=>e.length>0?e.join(", "):"none",co=(e,t)=>new z(`Entity '${e}' does not exist in schema. Available entities: ${tr(t)}`),Xt={string:e=>typeof e=="string",number:e=>typeof e=="number"&&!isNaN(e),boolean:e=>typeof e=="boolean",date:e=>e instanceof Date||typeof e=="string"||typeof e=="number",json:()=>!0},uo=(e,t)=>{var n,r;return e==null?!0:(r=(n=Xt[t.valueType])===null||n===void 0?void 0:n.call(Xt,e))!==null&&r!==void 0?r:!1},nr=(e,t)=>{const n=t.entities[e];if(!n)throw co(e,Object.keys(t.entities));return n},qe=(e,t,n)=>{const r=nr(e,n);if(typeof t!="object"||t===null)throw new z(`Arguments for data operation on entity '${e}' must be an object, but received: ${typeof t}`);for(const[i,s]of Object.entries(t)){if(i==="id")continue;const o=r.attrs[i];if(o&&!uo(s,o))throw new z(`Invalid value for attribute '${i}' in entity '${e}'. Expected ${o.valueType}, but received: ${typeof s}`)}},en=(e,t,n)=>{const r=nr(e,n);if(typeof t!="object"||t===null)throw new z(`Arguments for link operation on entity '${e}' must be an object, but received: ${typeof t}`);for(const[i,s]of Object.entries(t)){if(!r.links[i]){const a=Object.keys(r.links);throw new z(`Link '${i}' does not exist on entity '${e}'. Available links: ${tr(a)}`)}if(s!=null){if(Array.isArray(s)){for(const a of s)if(!ue(a))throw new z(`Invalid UUID in link '${i}' for entity '${e}'. Expected a UUID, but received: ${a}`)}else if(!ue(s))throw new z(`Invalid UUID in link '${i}' for entity '${e}'. Expected a UUID, but received: ${s}`)}}},lo={create:qe,update:qe,merge:qe,link:en,unlink:en,delete:()=>{}},fo=(e,t)=>{if(!t)return;const[n,r,i,s]=e;if(!Array.isArray(i)&&!ue(i))throw new z(`Invalid id for entity '${r}'. Expected a UUID, but received: ${i}`);if(typeof r!="string")throw new z(`Entity name must be a string, but received: ${typeof r}`);const o=lo[n];o&&s!==void 0&&o(r,s,t)},ho=(e,t)=>{const n=Array.isArray(e)?e:[e];for(const r of n){if(!r||typeof r!="object")throw new z(`Transaction chunk must be an object, but received: ${typeof r}`);if(!Array.isArray(r.__ops))throw new z(`Transaction chunk must have __ops array, but received: ${typeof r.__ops}`);for(const i of r.__ops){if(!Array.isArray(i))throw new z(`Transaction operation must be an array, but received: ${typeof i}`);fo(i,t)}}};var M=function(e,t,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(d){try{u(r.next(d))}catch(l){o(l)}}function c(d){try{u(r.throw(d))}catch(l){o(l)}}function u(d){d.done?s(d.value):i(d.value).then(a,c)}u((r=r.apply(e,t||[])).next())})},po=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n};const H={CONNECTING:"connecting",OPENED:"opened",AUTHENTICATED:"authenticated",CLOSED:"closed",ERRORED:"errored"},yo=3e4,bo=3e4,vo=0,tn=1,_o={apiURI:"https://api.instantdb.com",websocketURI:"wss://api.instantdb.com/runtime/session"},ze="_instant_oauth_redirect",Fe="currentUser";let go=0;function wo(e){const t=new WebSocket(e);return t._id=go++,t}function mo(){return typeof window<"u"||typeof chrome<"u"}const nn={"set-presence":!0,"set-presence-ok":!0,"refresh-presence":!0,"patch-presence":!0};function Oo(e,t){var n;const r=JSON.parse(e);for(const i in r){const s=r[i];if(!((n=s==null?void 0:s.result)===null||n===void 0)&&n.store){const o=s.result.store;s.result.store=ai(Object.assign(Object.assign({},o),{useDateObjects:t}))}}return r}function ko(e){var t;const n={};for(const r in e){const i=e[r],s=Object.assign({},i);!((t=i.result)===null||t===void 0)&&t.store&&(s.result=Object.assign(Object.assign({},i.result),{store:oi(i.result.store)})),n[r]=s}return JSON.stringify(n)}function rn(e){return[...e].sort((t,n)=>{const[r,i]=t,[s,o]=n,a=i.order||0,c=o.order||0;return a==c?r<s?-1:r>s?1:0:a-c})}class So{constructor(t,n=Jn,r=Hn,i){var s;this._isOnline=!0,this._isShutdown=!1,this.status=H.CONNECTING,this.queryCbs={},this.queryOnceDfds={},this.authCbs=[],this.attrsCbs=[],this.mutationErrorCbs=[],this.connectionStatusCbs=[],this.mutationDeferredStore=new Map,this._reconnectTimeoutId=null,this._reconnectTimeoutMs=0,this._localIdPromises={},this._errorMessage=null,this._oauthCallbackResponse=null,this._linkIndex=null,this._rooms={},this._roomsPendingLeave={},this._presence={},this._broadcastQueue=[],this._broadcastSubs={},this._currentUserCached={isLoading:!0,error:void 0,user:void 0},this._beforeUnloadCbs=[],this._dataForQueryCache={},this._onMergeQuerySubs=(o,a)=>{const c=o||{},u=Object.assign({},a);Object.entries(a).forEach(([l,f])=>{var h;const p=(h=c==null?void 0:c[l])===null||h===void 0?void 0:h.result,y=f.result;p&&!y&&(u[l].result=p)}),Object.keys(c).filter(l=>!a[l]).sort((l,f)=>{var h,p;const y=((h=c[l])===null||h===void 0?void 0:h.lastAccessed)||0;return(((p=c[f])===null||p===void 0?void 0:p.lastAccessed)||0)-y}).slice(0,this.queryCacheLimit).forEach(l=>{u[l]=c[l]}),this.querySubs.set(l=>u),this.loadedNotifyAll()},this._onMergePendingMutations=(o,a)=>{const c=new Map([...o.entries(),...a.entries()]);this.pendingMutations.set(d=>c),this.loadedNotifyAll(),this._rewriteMutationsSorted(this.attrs,o).forEach(([d,l])=>{!a.has(d)&&!l["tx-id"]&&this._sendMutation(d,l)})},this.getPreviousResult=o=>{const a=R(o);return this.dataForQuery(a)},this.notifyOne=o=>{var a,c;const u=(a=this.queryCbs[o])!==null&&a!==void 0?a:[],d=(c=this._dataForQueryCache[o])===null||c===void 0?void 0:c.data,l=this.dataForQuery(o);l&&(Ie(l,d)||u.forEach(f=>f.cb(l)))},this.notifyOneQueryOnce=o=>{var a;const c=(a=this.queryOnceDfds[o])!==null&&a!==void 0?a:[],u=this.dataForQuery(o);c.forEach(d=>{this._completeQueryOnce(d.q,o,d.dfd),d.dfd.resolve(u)})},this.notifyQueryError=(o,a)=>{(this.queryCbs[o]||[]).forEach(u=>u.cb({error:a}))},this.pushTx=o=>{this.config.disableValidation||ho(o,this.config.schema);try{const a=Fs({attrs:this.optimisticAttrs(),schema:this.config.schema,stores:Object.values(this.querySubs.currentValue).map(c=>{var u;return(u=c==null?void 0:c.result)===null||u===void 0?void 0:u.store}),useDateObjects:this.config.useDateObjects},o);return this.pushOps(a)}catch(a){return this.pushOps([],a)}},this.pushOps=(o,a)=>{const c=I(),u=[...this.pendingMutations.currentValue.values()],d=Math.max(0,...u.map(h=>h.order||0))+1,l={op:"transact","tx-steps":o,created:Date.now(),error:a,order:d};this.pendingMutations.set(h=>(h.set(c,l),h));const f=new Jt;return this.mutationDeferredStore.set(c,f),this._sendMutation(c,l),this.notifyAll(),f.promise},this._wsOnOpen=o=>{const a=o.target;if(this._ws!==a){this._log.info("[socket][open]",a._id,"skip; this is no longer the current ws");return}this._log.info("[socket][open]",this._ws._id),this._setStatus(H.OPENED),this.getCurrentUser().then(c=>{var u;this._trySend(I(),{op:"init","app-id":this.config.appId,"refresh-token":(u=c.user)===null||u===void 0?void 0:u.refresh_token,versions:this.versions,"__admin-token":this.config.__adminToken})}).catch(c=>{this._log.error("[socket][error]",a._id,c)})},this._wsOnMessage=o=>{const a=o.target,c=JSON.parse(o.data.toString());if(this._ws!==a){this._log.info("[socket][message]",a._id,c,"skip; this is no longer the current ws");return}this._handleReceive(a._id,JSON.parse(o.data.toString()))},this._wsOnError=o=>{const a=o.target;if(this._ws!==a){this._log.info("[socket][error]",a._id,"skip; this is no longer the current ws");return}this._log.error("[socket][error]",a._id,o)},this._wsOnClose=o=>{const a=o.target;if(this._ws!==a){this._log.info("[socket][close]",a._id,"skip; this is no longer the current ws");return}this._setStatus(H.CLOSED);for(const c of Object.values(this._rooms))c.isConnected=!1;if(this._isShutdown){this._log.info("[socket][close]",a._id,"Reactor has been shut down and will not reconnect");return}this._log.info("[socket][close]",a._id,"schedule reconnect, ms =",this._reconnectTimeoutMs),setTimeout(()=>{if(this._reconnectTimeoutMs=Math.min(this._reconnectTimeoutMs+1e3,1e4),!this._isOnline){this._log.info("[socket][close]",a._id,"we are offline, no need to start socket");return}this._startSocket()},this._reconnectTimeoutMs)},this.config=Object.assign(Object.assign({},_o),t),this.queryCacheLimit=(s=this.config.queryCacheLimit)!==null&&s!==void 0?s:10,this._log=ro(t.verbose||kt||Kn),this.versions=Object.assign(Object.assign({},i||{}),{"@instantdb/core":St}),this.config.schema&&(this._linkIndex=Zt(this.config.schema)),mo()&&(typeof BroadcastChannel=="function"&&(this._broadcastChannel=new BroadcastChannel("@instantdb"),this._broadcastChannel.addEventListener("message",o=>M(this,void 0,void 0,function*(){var a;try{if(((a=o.data)===null||a===void 0?void 0:a.type)==="auth"){const c=yield this.getCurrentUser();this.updateUser(c.user)}}catch(c){this._log.error("[error] handle broadcast channel",c)}}))),this._oauthCallbackResponse=this._oauthLoginInit(),this._initStorage(n),this.getCurrentUser(),r.getIsOnline().then(o=>{this._isOnline=o,this._startSocket(),r.listen(a=>{a!==this._isOnline&&(this._log.info("[network] online =",a),this._isOnline=a,this._isOnline?this._startSocket():(this._log.info("Changing status from",this.status,"to",H.CLOSED),this._setStatus(H.CLOSED)))})}),typeof addEventListener<"u"&&(this._beforeUnload=this._beforeUnload.bind(this),addEventListener("beforeunload",this._beforeUnload)))}updateSchema(t){this.config=Object.assign(Object.assign({},this.config),{schema:t,cardinalityInference:!!t}),this._linkIndex=t?Zt(this.config.schema):null}_initStorage(t){this._persister=new t(`instant_${this.config.appId}_5`),this.querySubs=new Ht(this._persister,"querySubs",{},this._onMergeQuerySubs,ko,n=>Oo(n,this.config.useDateObjects)),this.pendingMutations=new Ht(this._persister,"pendingMutations",new Map,this._onMergePendingMutations,n=>JSON.stringify([...n.entries()]),n=>new Map(JSON.parse(n))),this._beforeUnloadCbs.push(()=>{this.pendingMutations.flush(),this.querySubs.flush()})}_beforeUnload(){for(const t of this._beforeUnloadCbs)t()}_finishTransaction(t,n,r){const i=this.mutationDeferredStore.get(n);this.mutationDeferredStore.delete(n);const s=t!=="error"&&t!=="timeout";if(!i&&!s&&console.error("Mutation failed",Object.assign({status:t,eventId:n},r)),!!i)if(s)i.resolve({status:t,eventId:n});else if(r.type){const{status:o}=r,a=po(r,["status"]);i.reject(new De({body:a,status:o}))}else i.reject(new _e(r.message,r.hint))}_setStatus(t,n){this.status=t,this._errorMessage=n,this.notifyConnectionStatusSubs(t)}_flushEnqueuedRoomData(t){var n,r;const i=(r=(n=this._presence[t])===null||n===void 0?void 0:n.result)===null||r===void 0?void 0:r.user,s=this._broadcastQueue[t];if(this._broadcastQueue[t]=[],i&&this._trySetPresence(t,i),s)for(const o of s){const{topic:a,roomType:c,data:u}=o;this._tryBroadcast(t,c,a,u)}}_handleReceive(t,n){var r,i,s,o,a,c;const u=!!this.config.schema&&("cardinalityInference"in this.config?!!this.config.cardinalityInference:!0);switch(nn[n.op]||this._log.info("[receive]",t,n.op,n),n.op){case"init-ok":this._setStatus(H.AUTHENTICATED),this._reconnectTimeoutMs=0,this._setAttrs(n.attrs),this._flushPendingMessages(),this._sessionId=n["session-id"];for(const S of Object.keys(this._rooms)){const W=(i=(r=this._presence[S])===null||r===void 0?void 0:r.result)===null||i===void 0?void 0:i.user;this._tryJoinRoom(S,W)}break;case"add-query-exists":this.notifyOneQueryOnce(R(n.q));break;case"add-query-ok":const{q:d,result:l}=n,f=R(d),h=(o=(s=l==null?void 0:l[0])===null||s===void 0?void 0:s.data)===null||o===void 0?void 0:o["page-info"],p=(c=(a=l==null?void 0:l[0])===null||a===void 0?void 0:a.data)===null||c===void 0?void 0:c.aggregate,y=Kt(l),v=Ge(this.attrs,y,u,this._linkIndex,this.config.useDateObjects);this.querySubs.set(S=>(S[f].result={store:v,pageInfo:h,aggregate:p,processedTxId:n["processed-tx-id"]},S)),this._cleanupPendingMutationsQueries(),this.notifyOne(f),this.notifyOneQueryOnce(f),this._cleanupPendingMutationsTimeout();break;case"refresh-ok":const{computations:b,attrs:_}=n,m=n["processed-tx-id"];_&&this._setAttrs(_),this._cleanupPendingMutationsTimeout();const P=this._rewriteMutations(this.attrs,this.pendingMutations.currentValue,m);P!==this.pendingMutations.currentValue&&this.pendingMutations.set(()=>P);const w=rn(P.entries()),C=b.map(S=>{var W,le,fe,se;const or=S["instaql-query"],Y=S["instaql-result"],ar=R(or),cr=Kt(Y),ur=Ge(this.attrs,cr,u,this._linkIndex,this.config.useDateObjects),dr=this._applyOptimisticUpdates(ur,w,m),lr=(le=(W=Y==null?void 0:Y[0])===null||W===void 0?void 0:W.data)===null||le===void 0?void 0:le["page-info"],fr=(se=(fe=Y==null?void 0:Y[0])===null||fe===void 0?void 0:fe.data)===null||se===void 0?void 0:se.aggregate;return{hash:ar,store:dr,pageInfo:lr,aggregate:fr}});C.forEach(({hash:S,store:W,pageInfo:le,aggregate:fe})=>{this.querySubs.set(se=>(se[S].result={store:W,pageInfo:le,aggregate:fe,processedTxId:m},se))}),this._cleanupPendingMutationsQueries(),C.forEach(({hash:S})=>{this.notifyOne(S)});break;case"transact-ok":const{"client-event-id":$,"tx-id":Q}=n,Mt=this._rewriteMutations(this.attrs,this.pendingMutations.currentValue).get($);if(!Mt)break;this.pendingMutations.set(S=>(S.set($,Object.assign(Object.assign({},S.get($)),{"tx-id":Q,confirmed:Date.now()})),S)),this._cleanupPendingMutationsTimeout();const rr=Mt["tx-steps"].filter(([S,...W])=>S==="add-attr").map(([S,W])=>W).concat(Object.values(this.attrs));this._setAttrs(rr),this._finishTransaction("synced",$);break;case"patch-presence":{const S=n["room-id"];this._patchPresencePeers(S,n.edits),this._notifyPresenceSubs(S);break}case"refresh-presence":{const S=n["room-id"];this._setPresencePeers(S,n.data),this._notifyPresenceSubs(S);break}case"server-broadcast":const ir=n["room-id"],sr=n.topic;this._notifyBroadcastSubs(ir,sr,n);break;case"join-room-ok":const ie=n["room-id"],$t=this._rooms[ie];if(!$t){this._roomsPendingLeave[ie]&&(this._tryLeaveRoom(ie),delete this._roomsPendingLeave[ie]);break}$t.isConnected=!0,this._notifyPresenceSubs(ie),this._flushEnqueuedRoomData(ie);break;case"join-room-error":const At=n["room-id"],It=this._rooms[At];It&&(It.error=n.error),this._notifyPresenceSubs(At);break;case"error":this._handleReceiveError(n);break}}_handleMutationError(t,n,r){const i=this.pendingMutations.currentValue.get(n);if(i&&(t!=="timeout"||!i["tx-id"])){this.pendingMutations.set(o=>(o.delete(n),o));const s={message:r.message,hint:r.hint};this.notifyAll(),this.notifyAttrsSubs(),this.notifyMutationErrorSubs(s),this._finishTransaction(t,n,r)}}_handleReceiveError(t){var n,r,i,s,o;console.log("error",t);const a=t["client-event-id"],c=this.pendingMutations.currentValue.get(a),u={message:t.message||"Uh-oh, something went wrong. Ping Joe & Stopa."};if(t.hint&&(u.hint=t.hint),c){this._handleMutationError("error",a,t);return}if(!((n=t["original-event"])===null||n===void 0)&&n.hasOwnProperty("q")&&((r=t["original-event"])===null||r===void 0?void 0:r.op)==="add-query"){const f=(i=t["original-event"])===null||i===void 0?void 0:i.q,h=R(f);this.notifyQueryError(R(f),u),this.notifyQueryOnceError(f,h,a,u);return}if(((s=t["original-event"])===null||s===void 0?void 0:s.op)==="init"){if(t.type==="record-not-found"&&((o=t.hint)===null||o===void 0?void 0:o["record-type"])==="app-user"){this.changeCurrentUser(null);return}this._setStatus(H.ERRORED,u),this.notifyAll();return}const l=Object.assign({},t);delete l.message,delete l.hint,console.error(t.message,l),t.hint&&console.error(`This error comes with some debugging information. Here it is: 
`,t.hint)}notifyQueryOnceError(t,n,r,i){var s;const o=(s=this.queryOnceDfds[n])===null||s===void 0?void 0:s.find(a=>a.eventId===r);o&&(o.dfd.reject(i),this._completeQueryOnce(t,n,o.dfd))}_setAttrs(t){this.attrs=t.reduce((n,r)=>(n[r.id]=r,n),{}),this.notifyAttrsSubs()}_startQuerySub(t,n){const r=I();return this.querySubs.set(i=>(i[n]=i[n]||{q:t,result:null,eventId:r},i[n].lastAccessed=Date.now(),i)),this._trySendAuthed(r,{op:"add-query",q:t}),r}subscribeQuery(t,n,r){var i;this.config.disableValidation||Yt(t,this.config.schema),r&&"ruleParams"in r&&(t=Object.assign({$$ruleParams:r.ruleParams},t));const s=R(t),o=this.getPreviousResult(t);return o&&n(o),this.queryCbs[s]=(i=this.queryCbs[s])!==null&&i!==void 0?i:[],this.queryCbs[s].push({q:t,cb:n}),this._startQuerySub(t,s),()=>{this._unsubQuery(t,s,n)}}queryOnce(t,n){var r;this.config.disableValidation||Yt(t,this.config.schema),n&&"ruleParams"in n&&(t=Object.assign({$$ruleParams:n.ruleParams},t));const i=new Jt;if(!this._isOnline)return i.reject(new Error("We can't run `queryOnce`, because the device is offline.")),i.promise;if(!this.querySubs)return i.reject(new Error("We can't run `queryOnce` on the backend. Use adminAPI.query instead: https://www.instantdb.com/docs/backend#query")),i.promise;const s=R(t),o=this._startQuerySub(t,s);return this.queryOnceDfds[s]=(r=this.queryOnceDfds[s])!==null&&r!==void 0?r:[],this.queryOnceDfds[s].push({q:t,dfd:i,eventId:o}),setTimeout(()=>i.reject(new Error("Query timed out")),yo),i.promise}_completeQueryOnce(t,n,r){this.queryOnceDfds[n]&&(this.queryOnceDfds[n]=this.queryOnceDfds[n].filter(i=>i.dfd!==r),this._cleanupQuery(t,n))}_unsubQuery(t,n,r){this.queryCbs[n]&&(this.queryCbs[n]=this.queryCbs[n].filter(i=>i.cb!==r),this._cleanupQuery(t,n))}_cleanupQuery(t,n){var r,i;!((r=this.queryCbs[n])===null||r===void 0)&&r.length||!((i=this.queryOnceDfds[n])===null||i===void 0)&&i.length||(delete this.queryCbs[n],delete this.queryOnceDfds[n],this._trySendAuthed(I(),{op:"remove-query",q:t}))}_rewriteMutations(t,n,r){if(!t)return n;const i=d=>{const[l,f,h]=d["forward-identity"];return T(t,f,h)},s=d=>{const[l,f,h]=d["forward-identity"];return te(t,f,h)},o={attrIdMap:{},refSwapAttrIds:new Set};let a=!1;const c=(d,l)=>{const f=[];for(const h of d){const[p]=h;if(p==="add-attr"){const[v,b]=h,_=i(b);if(_&&b.id!==_.id){o.attrIdMap[b.id]=_.id,a=!0;continue}if(b["value-type"]==="ref"){const m=s(b);if(m){o.attrIdMap[b.id]=m.id,o.refSwapAttrIds.add(b.id),a=!0;continue}}}if(r&&l&&r>=l&&p==="add-attr"||p==="update-attr"||p==="delete-attr"){a=!0;continue}const y=a?_s(o,h):h;f.push(y)}return a?f:d},u=new Map;for(const[d,l]of n.entries())u.set(d,Object.assign(Object.assign({},l),{"tx-steps":c(l["tx-steps"],l["tx-id"])}));return a?u:n}_rewriteMutationsSorted(t,n){return rn(this._rewriteMutations(t,n).entries())}optimisticAttrs(){var t;const n=[...this.pendingMutations.currentValue.values()].flatMap(a=>a["tx-steps"]),r=new Set(n.filter(([a,c])=>a==="delete-attr").map(([a,c])=>c)),i=[];for(const[a,c]of n)if(a==="add-attr")i.push(c);else if(a==="update-attr"&&c.id&&(!((t=this.attrs)===null||t===void 0)&&t[c.id])){const u=Object.assign(Object.assign({},this.attrs[c.id]),c);i.push(u)}const s=[...Object.values(this.attrs||{}),...i].filter(a=>!r.has(a.id));return Object.fromEntries(s.map(a=>[a.id,a]))}dataForQuery(t){const n=this._errorMessage;if(n)return{error:n};if(!this.querySubs||!this.pendingMutations)return;const r=this.querySubs.version(),i=this.querySubs.currentValue,s=this.pendingMutations.version(),o=this.pendingMutations.currentValue,{q:a,result:c}=i[t]||{};if(!c)return;const u=this._dataForQueryCache[t];if(u&&r===u.querySubVersion&&s===u.pendingMutationsVersion)return u.data;const{store:d,pageInfo:l,aggregate:f,processedTxId:h}=c,p=this._rewriteMutationsSorted(d.attrs,o),y=this._applyOptimisticUpdates(d,p,h),v=hs({store:y,pageInfo:l,aggregate:f},a);return this._dataForQueryCache[t]={querySubVersion:r,pendingMutationsVersion:s,data:v},v}_applyOptimisticUpdates(t,n,r){for(const[i,s]of n)(!s["tx-id"]||r&&s["tx-id"]>r)&&(t=Oi(t,s["tx-steps"]));return t}notifyAll(){Object.keys(this.queryCbs).forEach(t=>{this.notifyOne(t)})}loadedNotifyAll(){this.pendingMutations.isLoading()||this.querySubs.isLoading()||this.notifyAll()}shutdown(){var t;this._log.info("[shutdown]",this.config.appId),this._isShutdown=!0,(t=this._ws)===null||t===void 0||t.close()}_sendMutation(t,n){if(n.error){this._handleMutationError("error",t,{message:n.error.message});return}if(this.status!==H.AUTHENTICATED){this._finishTransaction("enqueued",t);return}const r=Math.max(5e3,this.pendingMutations.currentValue.size*5e3);this._isOnline?(this._trySend(t,n),setTimeout(()=>{this._isOnline&&this._handleMutationError("timeout",t,{message:"transaction timed out"})},r)):this._finishTransaction("enqueued",t)}_flushPendingMessages(){Object.keys(this.queryCbs).map(i=>this.querySubs.currentValue[i]).filter(i=>i).forEach(({eventId:i,q:s})=>{this._trySendAuthed(i,{op:"add-query",q:s})}),Object.values(this.queryOnceDfds).flat().forEach(({eventId:i,q:s})=>{this._trySendAuthed(i,{op:"add-query",q:s})}),this._rewriteMutationsSorted(this.attrs,this.pendingMutations.currentValue).forEach(([i,s])=>{s["tx-id"]||this._sendMutation(i,s)})}_cleanupPendingMutationsQueries(){let t=Number.MAX_SAFE_INTEGER;for(const{result:n}of Object.values(this.querySubs.currentValue))n!=null&&n.processedTxId&&(t=Math.min(t,n==null?void 0:n.processedTxId));this.pendingMutations.set(n=>{for(const[r,i]of Array.from(n.entries()))i["tx-id"]&&i["tx-id"]<=t&&n.delete(r);return n})}_cleanupPendingMutationsTimeout(){const t=Date.now();this.pendingMutations.currentValue.size<200||this.pendingMutations.set(n=>{let r=!1,i=!1;for(const[s,o]of Array.from(n.entries()))o.confirmed||(i=!0),o.confirmed&&o.confirmed+bo<t&&(n.delete(s),r=!0);if(r&&i)for(const[s,o]of Array.from(n.entries()))o.confirmed||n.delete(s);return n})}_trySendAuthed(...t){this.status===H.AUTHENTICATED&&this._trySend(...t)}_trySend(t,n,r){this._ws.readyState===tn&&(nn[n.op]||this._log.info("[send]",this._ws._id,n.op,n),this._ws.send(JSON.stringify(Object.assign({"client-event-id":t},n))))}_startSocket(){if(this._isShutdown){this._log.info("[socket][start]",this.config.appId,"Reactor has been shut down and will not start a new socket");return}if(this._ws&&this._ws.readyState==vo){this._log.info("[socket][start]",this._ws._id,"maintained as current ws, we were still in a connecting state");return}const t=this._ws;this._ws=wo(`${this.config.websocketURI}?app_id=${this.config.appId}`),this._ws.onopen=this._wsOnOpen,this._ws.onmessage=this._wsOnMessage,this._ws.onclose=this._wsOnClose,this._ws.onerror=this._wsOnError,this._log.info("[socket][start]",this._ws._id),(t==null?void 0:t.readyState)===tn&&(this._log.info("[socket][start]",this._ws._id,"close previous ws id = ",t._id),t.close())}getLocalId(t){return M(this,void 0,void 0,function*(){const n=`localToken_${t}`,r=yield this._persister.getItem(n);if(r)return r;if(this._localIdPromises[n])return this._localIdPromises[n];const i=I();return this._localIdPromises[n]=this._persister.setItem(n,i).then(()=>i),this._localIdPromises[n]})}_replaceUrlAfterOAuth(){if(typeof URL>"u")return;const t=new URL(window.location.href);if(t.searchParams.get(ze)){const n=t.toString();t.searchParams.delete(ze),t.searchParams.delete("code"),t.searchParams.delete("error");const r=t.pathname+(t.searchParams.size?"?"+t.searchParams:"")+t.hash;if(history.replaceState(history.state,"",r),typeof navigation=="object"&&typeof navigation.addEventListener=="function"&&typeof navigation.removeEventListener=="function"){let i=!1;const s=o=>{var a;i||(i=!0,navigation.removeEventListener("navigate",s),!o.userInitiated&&o.navigationType==="replace"&&((a=o.destination)===null||a===void 0?void 0:a.url)===n&&history.replaceState(history.state,"",r))};navigation.addEventListener("navigate",s)}}}_oauthLoginInit(){return M(this,void 0,void 0,function*(){var t,n,r,i;if(typeof window>"u"||typeof window.location>"u"||typeof URLSearchParams>"u")return null;const s=new URLSearchParams(window.location.search);if(!s.get(ze))return null;const o=s.get("error");if(o)return this._replaceUrlAfterOAuth(),{error:{message:o}};const a=s.get("code");if(!a)return null;this._replaceUrlAfterOAuth();try{const{user:c}=yield Wt({apiURI:this.config.apiURI,appId:this.config.appId,code:a});return this.setCurrentUser(c),null}catch(c){return((t=c==null?void 0:c.body)===null||t===void 0?void 0:t.type)==="record-not-found"&&((r=(n=c==null?void 0:c.body)===null||n===void 0?void 0:n.hint)===null||r===void 0?void 0:r["record-type"])==="app-oauth-code"&&(yield this._hasCurrentUser())?null:{error:{message:((i=c==null?void 0:c.body)===null||i===void 0?void 0:i.message)||"Error logging in."}}}})}_waitForOAuthCallbackResponse(){return M(this,void 0,void 0,function*(){return yield this._oauthCallbackResponse})}__subscribeMutationErrors(t){return this.mutationErrorCbs.push(t),()=>{this.mutationErrorCbs=this.mutationErrorCbs.filter(n=>n!==t)}}subscribeAuth(t){this.authCbs.push(t);const n=this._currentUserCached;n.isLoading||t(this._currentUserCached);let r=!1;return this.getCurrentUser().then(i=>{r||Ie(i,n)||t(i)}),()=>{r=!0,this.authCbs=this.authCbs.filter(i=>i!==t)}}getAuth(){return M(this,void 0,void 0,function*(){const{user:t,error:n}=yield this.getCurrentUser();if(n)throw new _e("Could not get current user: "+n.message);return t})}subscribeConnectionStatus(t){return this.connectionStatusCbs.push(t),()=>{this.connectionStatusCbs=this.connectionStatusCbs.filter(n=>n!==t)}}subscribeAttrs(t){return this.attrsCbs.push(t),this.attrs&&t(this.attrs),()=>{this.attrsCbs=this.attrsCbs.filter(n=>n!==t)}}notifyAuthSubs(t){this.authCbs.forEach(n=>n(t))}notifyMutationErrorSubs(t){this.mutationErrorCbs.forEach(n=>n(t))}notifyAttrsSubs(){if(!this.attrs)return;const t=this.optimisticAttrs();this.attrsCbs.forEach(n=>n(t))}notifyConnectionStatusSubs(t){this.connectionStatusCbs.forEach(n=>n(t))}setCurrentUser(t){return M(this,void 0,void 0,function*(){yield this._persister.setItem(Fe,JSON.stringify(t))})}getCurrentUserCached(){return this._currentUserCached}getCurrentUser(){return M(this,void 0,void 0,function*(){const t=yield this._waitForOAuthCallbackResponse();if(t!=null&&t.error){const i={error:t.error,user:void 0};return this._currentUserCached=Object.assign({isLoading:!1},i),i}const n=yield this._persister.getItem(Fe),r={user:JSON.parse(n),error:void 0};return this._currentUserCached=Object.assign({isLoading:!1},r),r})}_hasCurrentUser(){return M(this,void 0,void 0,function*(){const t=yield this._persister.getItem(Fe);return JSON.parse(t)!=null})}changeCurrentUser(t){return M(this,void 0,void 0,function*(){var n;const{user:r}=yield this.getCurrentUser();if(!Ie(r,t)){yield this.setCurrentUser(t),this.updateUser(t);try{(n=this._broadcastChannel)===null||n===void 0||n.postMessage({type:"auth"})}catch(i){console.error("Error posting message to broadcast channel",i)}}})}updateUser(t){const n={error:void 0,user:t};this._currentUserCached=Object.assign({isLoading:!1},n),this._dataForQueryCache={},this.querySubs.set(r=>(Object.keys(r).forEach(i=>{delete r[i].result}),r)),this._reconnectTimeoutMs=0,this._ws.close(),this._oauthCallbackResponse=null,this.notifyAuthSubs(n)}sendMagicCode({email:t}){return Ws({apiURI:this.config.apiURI,appId:this.config.appId,email:t})}signInWithMagicCode(t){return M(this,arguments,void 0,function*({email:n,code:r}){const i=yield Bs({apiURI:this.config.apiURI,appId:this.config.appId,email:n,code:r});return yield this.changeCurrentUser(i.user),i})}signInWithCustomToken(t){return M(this,void 0,void 0,function*(){const n=yield Js({apiURI:this.config.apiURI,appId:this.config.appId,refreshToken:t});return yield this.changeCurrentUser(n.user),n})}potentiallyInvalidateToken(t,n){var r;const i=(r=t==null?void 0:t.user)===null||r===void 0?void 0:r.refresh_token;if(!i)return;if(n.invalidateToken===!1){this._log.info("[auth-invalidate] skipped invalidateToken");return}Ks({apiURI:this.config.apiURI,appId:this.config.appId,refreshToken:i}).then(()=>{this._log.info("[auth-invalidate] completed invalidateToken")}).catch(o=>{})}signOut(t){return M(this,void 0,void 0,function*(){const n=yield this.getCurrentUser();this.potentiallyInvalidateToken(n,t),yield this.changeCurrentUser(null)})}createAuthorizationURL({clientName:t,redirectURL:n}){const{apiURI:r,appId:i}=this.config;return`${r}/runtime/oauth/start?app_id=${i}&client_name=${t}&redirect_uri=${n}`}exchangeCodeForToken(t){return M(this,arguments,void 0,function*({code:n,codeVerifier:r}){const i=yield Wt({apiURI:this.config.apiURI,appId:this.config.appId,code:n,codeVerifier:r});return yield this.changeCurrentUser(i.user),i})}issuerURI(){const{apiURI:t,appId:n}=this.config;return`${t}/runtime/${n}`}signInWithIdToken(t){return M(this,arguments,void 0,function*({idToken:n,clientName:r,nonce:i}){var s;const o=yield this.getCurrentUser(),a=(s=o==null?void 0:o.user)===null||s===void 0?void 0:s.refresh_token,c=yield Hs({apiURI:this.config.apiURI,appId:this.config.appId,idToken:n,clientName:r,nonce:i,refreshToken:a});return yield this.changeCurrentUser(c.user),c})}joinRoom(t,n){return this._rooms[t]||(this._rooms[t]={isConnected:!1,error:void 0}),this._presence[t]=this._presence[t]||{},n&&(this._presence[t].result=this._presence[t].result||{},this._presence[t].result.user=n,this._notifyPresenceSubs(t)),this._tryJoinRoom(t,n),()=>{this._cleanupRoom(t)}}_cleanupRoom(t){var n,r,i,s;if(!(!((r=(n=this._presence[t])===null||n===void 0?void 0:n.handlers)===null||r===void 0)&&r.length)&&!Object.keys((i=this._broadcastSubs[t])!==null&&i!==void 0?i:{}).length){const o=(s=this._rooms[t])===null||s===void 0?void 0:s.isConnected;delete this._rooms[t],delete this._presence[t],delete this._broadcastSubs[t],o?this._tryLeaveRoom(t):this._roomsPendingLeave[t]=!0}}getPresence(t,n,r={}){const i=this._rooms[n],s=this._presence[n];return!i||!s||!s.result?null:Object.assign(Object.assign({},to(s.result,r,this._sessionId)),{isLoading:!i.isConnected,error:i.error})}publishPresence(t,n,r){const i=this._rooms[n],s=this._presence[n];if(!i||!s)return;s.result=s.result||{};const o=Object.assign(Object.assign({},s.result.user),r);s.result.user=o,i.isConnected&&(this._trySetPresence(n,o),this._notifyPresenceSubs(n))}_trySetPresence(t,n){this._trySendAuthed(I(),{op:"set-presence","room-id":t,data:n})}_tryJoinRoom(t,n){this._trySendAuthed(I(),{op:"join-room","room-id":t,data:n}),delete this._roomsPendingLeave[t]}_tryLeaveRoom(t){this._trySendAuthed(I(),{op:"leave-room","room-id":t})}subscribePresence(t,n,r,i){const s=this.joinRoom(n,r.data),o=Object.assign(Object.assign({},r),{roomId:n,cb:i,prev:null});return this._presence[n]=this._presence[n]||{},this._presence[n].handlers=this._presence[n].handlers||[],this._presence[n].handlers.push(o),this._notifyPresenceSub(n,o),()=>{var a,c,u;this._presence[n].handlers=(u=(c=(a=this._presence[n])===null||a===void 0?void 0:a.handlers)===null||c===void 0?void 0:c.filter(d=>d!==o))!==null&&u!==void 0?u:[],s()}}_notifyPresenceSubs(t){var n,r;(r=(n=this._presence[t])===null||n===void 0?void 0:n.handlers)===null||r===void 0||r.forEach(i=>{this._notifyPresenceSub(t,i)})}_notifyPresenceSub(t,n){const r=this.getPresence("",t,n);r&&(n.prev&&!no(r,n.prev)||(n.prev=r,n.cb(r)))}_patchPresencePeers(t,n){var r,i,s;const o=((i=(r=this._presence[t])===null||r===void 0?void 0:r.result)===null||i===void 0?void 0:i.peers)||{};let a=Object.fromEntries(Object.entries(o).map(([u,d])=>[u,{data:d}]));(s=this._presence[t])===null||s===void 0||s.result;const c=Ze(a,u=>{for(let[d,l,f]of n)switch(l){case"+":Wr(u,d,f);break;case"r":Rt(u,d,f);break;case"-":Pn(u,d);break}delete u[this._sessionId]});this._setPresencePeers(t,c)}_setPresencePeers(t,n){const r=Object.assign({},n);delete r[this._sessionId];const i=Object.fromEntries(Object.entries(r).map(([s,o])=>[s,o.data]));this._presence=Ze(this._presence,s=>{Rt(s,[t,"result","peers"],i)})}publishTopic({roomType:t,roomId:n,topic:r,data:i}){var s;const o=this._rooms[n];if(o){if(!o.isConnected){this._broadcastQueue[n]=(s=this._broadcastQueue[n])!==null&&s!==void 0?s:[],this._broadcastQueue[n].push({topic:r,roomType:t,data:i});return}this._tryBroadcast(n,t,r,i)}}_tryBroadcast(t,n,r,i){this._trySendAuthed(I(),{op:"client-broadcast","room-id":t,roomType:n,topic:r,data:i})}subscribeTopic(t,n,r){const i=this.joinRoom(t);return this._broadcastSubs[t]=this._broadcastSubs[t]||{},this._broadcastSubs[t][n]=this._broadcastSubs[t][n]||[],this._broadcastSubs[t][n].push(r),this._presence[t]=this._presence[t]||{},()=>{this._broadcastSubs[t][n]=this._broadcastSubs[t][n].filter(s=>s!==r),this._broadcastSubs[t][n].length||delete this._broadcastSubs[t][n],i()}}_notifyBroadcastSubs(t,n,r){var i,s,o;(o=(s=(i=this._broadcastSubs)===null||i===void 0?void 0:i[t])===null||s===void 0?void 0:s[n])===null||o===void 0||o.forEach(a=>{var c,u,d,l,f,h;const p=(c=r.data)===null||c===void 0?void 0:c.data,y=r.data["peer-id"]===this._sessionId?(d=(u=this._presence[t])===null||u===void 0?void 0:u.result)===null||d===void 0?void 0:d.user:(h=(f=(l=this._presence[t])===null||l===void 0?void 0:l.result)===null||f===void 0?void 0:f.peers)===null||h===void 0?void 0:h[r.data["peer-id"]];return a(p,y)})}uploadFile(t,n,r){return M(this,void 0,void 0,function*(){var i;const s=yield this.getCurrentUser(),o=(i=s==null?void 0:s.user)===null||i===void 0?void 0:i.refresh_token;return Zs(Object.assign(Object.assign({},r),{apiURI:this.config.apiURI,appId:this.config.appId,path:t,file:n,refreshToken:o}))})}deleteFile(t){return M(this,void 0,void 0,function*(){var n;const r=yield this.getCurrentUser(),i=(n=r==null?void 0:r.user)===null||n===void 0?void 0:n.refresh_token;return yield Gs({apiURI:this.config.apiURI,appId:this.config.appId,path:t,refreshToken:i})})}upload(t,n){return M(this,void 0,void 0,function*(){var r;const i=yield this.getCurrentUser(),s=(r=i==null?void 0:i.user)===null||r===void 0?void 0:r.refresh_token,o=t||n.name,a=yield Ys({apiURI:this.config.apiURI,appId:this.config.appId,fileName:o,refreshToken:s});return yield Xs(a,n)})}getDownloadUrl(t){return M(this,void 0,void 0,function*(){var n;const r=yield this.getCurrentUser(),i=(n=r==null?void 0:r.user)===null||n===void 0?void 0:n.refresh_token;return yield eo({apiURI:this.config.apiURI,appId:this.config.appId,path:t,refreshToken:i})})}}let Me;function jo(e,t){Me==null||Me.dispose();const n=Eo(t),r=Ao(t,a),i=$o(Mo(e));function s(d){var l;d.source===i.element.contentWindow&&((l=d.data)===null||l===void 0?void 0:l.type)==="close"&&n.isVisible()&&a()}function o(d){const l=d.shiftKey&&d.ctrlKey&&d.key==="0",f=d.key==="Escape"||d.key==="Esc";(l||f&&n.isVisible())&&a()}function a(){n.isVisible()?n.element.style.display="none":(n.element.style.display="block",n.element.contains(i.element)||n.element.appendChild(i.element))}function c(){n.element.remove(),r.element.remove(),removeEventListener("keydown",o),removeEventListener("message",s)}function u(){document.body.appendChild(n.element),document.body.appendChild(r.element),addEventListener("keydown",o),addEventListener("message",s),Me={dispose:c}}return u()}function Mo(e){return`${kt||Zn?"http://localhost:3000":"https://instantdb.com"}/_devtool?appId=${e}`}function $o(e){const t=document.createElement("iframe");return t.src=e,t.className="instant-devtool-iframe",Object.assign(t.style,{width:"100%",height:"100%",backgroundColor:"white",border:"none"}),{element:t}}function Ao(e,t){const n=`
    <svg width="32" height="32" viewBox="0 0 512 512" fill="none" xmlns="http://www.w3.org/2000/svg">
      <rect width="512" height="512" fill="black"/>
      <rect x="97.0973" y="91.3297" width="140" height="330" fill="white"/>
    </svg>
  `,r=document.createElement("button");return r.innerHTML=n,r.className="instant-devtool-toggler",Object.assign(r.style,Object.assign(Object.assign({position:"fixed"},Io(e.position)),{height:"32px",width:"32px",display:"flex",alignItems:"center",justifyContent:"center",zIndex:"9010",padding:"0",margin:"0",border:"none",cursor:"pointer"})),r.addEventListener("click",t),{element:r}}function Io(e){switch(e){case"bottom-left":return{bottom:"24px",left:"24px"};case"bottom-right":return{bottom:"24px",right:"24px"};case"top-right":return{top:"24px",right:"24px"};case"top-left":return{top:"24px",left:"24px"}}}function To(e){switch(e){case"bottom-left":return{bottom:"24px",right:"24px",left:"60px",top:"72px"};case"bottom-right":return{bottom:"24px",left:"24px",right:"60px",top:"72px"};case"top-right":return{top:"24px",left:"24px",right:"60px",bottom:"72px"};case"top-left":return{top:"24px",right:"24px",left:"60px",bottom:"72px"}}}function Eo(e){const t=document.createElement("div");Object.assign(t.style,Object.assign(Object.assign({position:"fixed"},To(e.position)),{display:"block",borderRadius:"4px",border:"1px #ccc solid",boxShadow:"0px 0px 8px #00000044",backgroundColor:"#eee",zIndex:"999990"})),t.style.display="none",t.className="instant-devtool-container";function n(){return t.style.display!=="none"}return{element:t,isVisible:n}}const Po={apiURI:"https://api.instantdb.com",websocketURI:"wss://api.instantdb.com/runtime/session"};function xo(){var e;return globalThis.__instantDbSchemaHashStore=(e=globalThis.__instantDbSchemaHashStore)!==null&&e!==void 0?e:new WeakMap,globalThis.__instantDbSchemaHashStore}function Co(){var e;return globalThis.__instantDbStore=(e=globalThis.__instantDbStore)!==null&&e!==void 0?e:{},globalThis.__instantDbStore}function ct(e){const t=e.__adminToken;return e.appId+"_"+(e.websocketURI||"default_ws_uri")+"_"+(e.apiURI||"default_api_uri")+"_"+(t||"client_only")+"_"+e.useDateObjects}const ut=Co(),Ve=xo();class Ro{constructor(t){this.db=t,this.sendMagicCode=n=>this.db.sendMagicCode(n),this.signInWithMagicCode=n=>this.db.signInWithMagicCode(n),this.signInWithToken=n=>this.db.signInWithCustomToken(n),this.createAuthorizationURL=n=>this.db.createAuthorizationURL(n),this.signInWithIdToken=n=>this.db.signInWithIdToken(n),this.exchangeOAuthCode=n=>this.db.exchangeCodeForToken(n),this.issuerURI=()=>this.db.issuerURI(),this.signOut=(n={invalidateToken:!0})=>this.db.signOut(n)}}class Do{constructor(t){this.db=t,this.uploadFile=(n,r,i={})=>this.db.uploadFile(n,r,i),this.delete=n=>this.db.deleteFile(n),this.upload=(n,r)=>this.db.upload(n,r),this.put=this.upload,this.getDownloadUrl=n=>this.db.getDownloadUrl(n)}}function Uo(e){return JSON.parse(JSON.stringify(e))}class Lo{constructor(t){this.tx=Ot(),this._reactor=t,this.auth=new Ro(this._reactor),this.storage=new Do(this._reactor)}transact(t){return this._reactor.pushTx(t)}getLocalId(t){return this._reactor.getLocalId(t)}subscribeQuery(t,n,r){return this._reactor.subscribeQuery(t,n,r)}subscribeAuth(t){return this._reactor.subscribeAuth(t)}getAuth(){return this._reactor.getAuth()}subscribeConnectionStatus(t){return this._reactor.subscribeConnectionStatus(t)}joinRoom(t="_defaultRoomType",n="_defaultRoomId",r){return{leaveRoom:this._reactor.joinRoom(n,r==null?void 0:r.initialPresence),subscribeTopic:(s,o)=>this._reactor.subscribeTopic(n,s,o),subscribePresence:(s,o)=>this._reactor.subscribePresence(t,n,s,o),publishTopic:(s,o)=>this._reactor.publishTopic({roomType:t,roomId:n,topic:s,data:o}),publishPresence:s=>this._reactor.publishPresence(t,n,s),getPresence:s=>this._reactor.getPresence(t,n,s)}}shutdown(){delete ut[ct(this._reactor.config)],this._reactor.shutdown()}queryOnce(t,n){return this._reactor.queryOnce(t,n)}}function sn(e){if(!e)return"0";if(Ve.get(e))return Ve.get(e);const t=R(e);return Ve.set(e,t),t}function No(e,t){return sn(e._reactor.config.schema)!==sn(t)}function qo(e,t,n,r){const i=ut[ct(e)];if(i)return No(i,e.schema)&&i._reactor.updateSchema(e.schema),i;const s=new So(Object.assign(Object.assign(Object.assign({},Po),e),{cardinalityInference:!!e.schema}),t||Jn,n||Hn,Object.assign(Object.assign({},r||{}),{"@instantdb/core":St})),o=new Lo(s);return ut[ct(e)]=o,zo(e.appId,e.devtool),o}function zo(e,t){if(typeof window>"u"||typeof window.location>"u"||typeof document>"u"||typeof t=="boolean"&&!t)return;const n=Object.assign({position:"bottom-right",allowedHosts:["localhost"]},typeof t=="object"?t:{});n.allowedHosts.includes(window.location.hostname)&&jo(e,n)}const Fo={isLoading:!0,data:void 0,pageInfo:void 0,error:void 0};function on(e){return Object.assign({isLoading:!e,data:void 0,pageInfo:void 0,error:void 0},e||{})}function Vo(e,t,n){t&&n&&"ruleParams"in n&&(t=Object.assign({$$ruleParams:n.ruleParams},t));const r=t?Uo(t):null,i=R(r),s=O.useRef(on(e._reactor.getPreviousResult(r))),o=O.useCallback(c=>(s.current=on(e._reactor.getPreviousResult(r)),r?e.subscribeQuery(r,d=>{s.current=Object.assign({isLoading:!d,data:void 0,pageInfo:void 0,error:void 0},d),c()}):()=>{}),[i]);return{state:O.useSyncExternalStore(o,()=>s.current,()=>Fo),query:r}}function Qo(){const e=O.useRef(null);O.useEffect(()=>{n()},[]);function t(r,i){clearTimeout(e.current),e.current=setTimeout(i,r)}function n(){clearTimeout(e.current)}return{set:t,clear:n}}const Wo=1e3;function Bo(e,t,n){O.useEffect(()=>e._core._reactor.subscribeTopic(e.id,t,(i,s)=>{n(i,s)}),[e.id,t])}function Jo(e,t){return O.useEffect(()=>e._core._reactor.joinRoom(e.id),[e.id]),O.useCallback(r=>{e._core._reactor.publishTopic({roomType:e.type,roomId:e.id,topic:t,data:r})},[e.id,t])}function Ho(e,t={}){var n,r;const[i,s]=O.useState(()=>{var c;return(c=e._core._reactor.getPresence(e.type,e.id,t))!==null&&c!==void 0?c:{peers:{},isLoading:!0}});O.useEffect(()=>e._core._reactor.subscribePresence(e.type,e.id,t,u=>{s(u)}),[e.id,t.user,(n=t.peers)===null||n===void 0?void 0:n.join(),(r=t.keys)===null||r===void 0?void 0:r.join()]);const o=O.useCallback(c=>{e._core._reactor.publishPresence(e.type,e.id,c)},[e.type,e.id]);return O.useMemo(()=>Object.assign(Object.assign({},i),{publishPresence:o}),[i,o])}function Ko(e,t,n){O.useEffect(()=>e._core._reactor.joinRoom(e.id,t),[e.id]),O.useEffect(()=>e._core._reactor.publishPresence(e.type,e.id,t),[e.type,e.id,n??JSON.stringify(t)])}function Zo(e,t,n={}){const r=Qo(),i=X.usePresence(e,{keys:[t]}),s=O.useMemo(()=>{var d;const l=e._core._reactor.getPresence(e.type,e.id);return n!=null&&n.writeOnly?[]:Object.values((d=l==null?void 0:l.peers)!==null&&d!==void 0?d:{}).filter(f=>f[t]===!0)},[n==null?void 0:n.writeOnly,i]),o=O.useCallback(d=>{var l;e._core._reactor.publishPresence(e.type,e.id,{[t]:d}),d&&((n==null?void 0:n.timeout)===null||(n==null?void 0:n.timeout)===0||r.set((l=n==null?void 0:n.timeout)!==null&&l!==void 0?l:Wo,()=>{e._core._reactor.publishPresence(e.type,e.id,{[t]:null})}))},[e.type,e.id,t,n==null?void 0:n.timeout,r]),a=O.useCallback(d=>{const f=!((n==null?void 0:n.stopOnEnter)&&d.key==="Enter");o(f)},[n.stopOnEnter,o]),c=O.useCallback(()=>{o(!1)},[o]),u=O.useMemo(()=>({onKeyDown:a,onBlur:c}),[a,c]);return{active:s,setActive:o,inputProps:u}}const X={useTopicEffect:Bo,usePublishTopic:Jo,usePresence:Ho,useSyncPresence:Ko,useTypingIndicator:Zo};class Go{constructor(t,n,r){this.useTopicEffect=(i,s)=>{X.useTopicEffect(this,i,s)},this.usePublishTopic=i=>X.usePublishTopic(this,i),this.usePresence=(i={})=>X.usePresence(this,i),this.useSyncPresence=(i,s)=>X.useSyncPresence(this,i,s),this.useTypingIndicator=(i,s={})=>X.useTypingIndicator(this,i,s),this._core=t,this.type=n,this.id=r}}var Yo=function(e,t,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(d){try{u(r.next(d))}catch(l){o(l)}}function c(d){try{u(r.throw(d))}catch(l){o(l)}}function u(d){d.done?s(d.value):i(d.value).then(a,c)}u((r=r.apply(e,t||[])).next())})};const Xo={isLoading:!0,user:void 0,error:void 0};class ea{constructor(t,n){this.tx=Ot(),this.getLocalId=r=>this._core.getLocalId(r),this.useLocalId=r=>{const[i,s]=O.useState(null);return O.useEffect(()=>{Yo(this,void 0,void 0,function*(){const a=yield this.getLocalId(r);s(a)})},[r]),i},this.rooms=X,this.transact=r=>this._core.transact(r),this.useQuery=(r,i)=>Vo(this._core,r,i).state,this.useAuth=()=>{const r=O.useRef(this._core._reactor._currentUserCached),i=O.useCallback(o=>this._core.subscribeAuth(c=>{r.current=Object.assign({isLoading:!1},c),o()}),[]);return O.useSyncExternalStore(i,()=>r.current,()=>Xo)},this.useConnectionStatus=()=>{const r=O.useRef(this._core._reactor.status),i=O.useCallback(o=>this._core.subscribeConnectionStatus(c=>{c!==r.current&&(r.current=c,o())}),[]);return O.useSyncExternalStore(i,()=>r.current,()=>"connecting")},this.queryOnce=(r,i)=>this._core.queryOnce(r,i),this._core=qo(t,this.constructor.Storage,this.constructor.NetworkListener,n),this.auth=this._core.auth,this.storage=this._core.storage}room(t="_defaultRoomType",n="_defaultRoomId"){return new Go(this._core,t,n)}getAuth(){return this._core.getAuth()}}class ta extends ea{}function ca(e){return new ta(e,{"@instantdb/react":St})}var na=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],ua=na.reduce((e,t)=>{const n=pr(`Primitive.${t}`),r=O.forwardRef((i,s)=>{const{asChild:o,...a}=i,c=o?n:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),an.jsx(c,{...a,ref:s})});return r.displayName=`Primitive.${t}`,{...e,[t]:r}},{});function da(e,t){e&&yr.flushSync(()=>e.dispatchEvent(t))}const la=e=>({default:Qe,cooking:mn,coffee:pn,snacks:gn,cleaning:ln,baby:un,cigarette:hn,book:dn,shirt:wn,rice:On,oil:bn,fruit:cn,vegetable:fn,milk:_n,fish:vn,drink:yn})[e]||Qe,fa=[{key:"default",name:"Default",component:Qe},{key:"cooking",name:"Bumbu & Masakan",component:mn},{key:"coffee",name:"Minuman",component:pn},{key:"drink",name:"Minuman Dalam Kemasan",component:yn},{key:"snacks",name:"Camilan",component:gn},{key:"cleaning",name:"Pembersih",component:ln},{key:"baby",name:"Produk Bayi",component:un},{key:"cigarette",name:"Rokok",component:hn},{key:"book",name:"Buku",component:dn},{key:"shirt",name:"Pakaian",component:wn},{key:"rice",name:"Beras",component:On},{key:"oil",name:"Minyak",component:bn},{key:"fruit",name:"Buah",component:cn},{key:"vegetable",name:"Sayuran",component:fn},{key:"milk",name:"Susu & Olahan",component:_n},{key:"fish",name:"Ikan & Laut",component:vn}],ha={instantDbAppId:"8d8f5941-3c7b-4f08-a523-3cd8ff015948"};export{oa as I,ua as P,I as a,fa as b,da as d,ha as e,la as g,ca as i,aa as t};
